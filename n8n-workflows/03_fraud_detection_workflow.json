{
  "name": "ğŸš¨ ì‚¬ê¸° íƒì§€ ì¼ì¼ ë¶„ì„ ì›Œí¬í”Œë¡œìš°",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 24,
              "triggerAtHour": 2
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "â° ë§¤ì¼ 02:00 ì‹¤í–‰",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [0, 300]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "fraud/analyze-batch",
        "options": {}
      },
      "id": "webhook-manual",
      "name": "ğŸ“¥ ìˆ˜ë™ ë¶„ì„ íŠ¸ë¦¬ê±°",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [0, 500],
      "webhookId": "fraud-analyze-batch"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://insurtech-api:3000/api/auth/login",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "username",
              "value": "system"
            },
            {
              "name": "password",
              "value": "system123!"
            }
          ]
        },
        "options": {}
      },
      "id": "auth-login",
      "name": "ğŸ” ì‹œìŠ¤í…œ ë¡œê·¸ì¸",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [220, 400]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  c.*,\n  p.customer_id,\n  cu.name as customer_name,\n  cu.risk_grade,\n  cu.risk_score as customer_risk_score\nFROM claims c\nJOIN policies p ON c.policy_id = p.id\nJOIN customers cu ON p.customer_id = cu.id\nWHERE c.created_at >= NOW() - INTERVAL '24 hours'\n  AND c.status IN ('PENDING', 'IN_PROGRESS')\nORDER BY c.created_at DESC",
        "options": {}
      },
      "id": "get-recent-claims",
      "name": "ğŸ“Š ìµœê·¼ 24ì‹œê°„ ì²­êµ¬ ì¡°íšŒ",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [440, 300],
      "credentials": {
        "postgres": {
          "id": "postgres-db",
          "name": "InsurTech DB"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  c.id,\n  c.claim_number,\n  c.fraud_score,\n  c.fraud_risk_level,\n  c.customer_name,\n  c.total_medical_expense,\n  c.diagnosis_code,\n  c.hospital_name,\n  c.created_at\nFROM claims c\nWHERE c.fraud_score >= 50\n  AND c.status NOT IN ('APPROVED', 'REJECTED')\nORDER BY c.fraud_score DESC\nLIMIT 100",
        "options": {}
      },
      "id": "get-high-risk-claims",
      "name": "ğŸ”´ ê³ ìœ„í—˜ ì²­êµ¬ ì¡°íšŒ",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [440, 500],
      "credentials": {
        "postgres": {
          "id": "postgres-db",
          "name": "InsurTech DB"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "id": "merge-claims",
      "name": "ğŸ”— ì²­êµ¬ ë°ì´í„° ë³‘í•©",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [660, 400]
    },
    {
      "parameters": {
        "batchSize": 10,
        "options": {}
      },
      "id": "split-batch",
      "name": "ğŸ“¦ 10ê±´ì”© ë°°ì¹˜ ì²˜ë¦¬",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [880, 400]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=SELECT \n  c.id,\n  c.claim_number,\n  c.diagnosis_code,\n  c.hospital_name,\n  c.total_medical_expense,\n  c.treatment_start_date,\n  c.created_at\nFROM claims c\nJOIN policies p ON c.policy_id = p.id\nWHERE p.customer_id = (\n  SELECT p2.customer_id \n  FROM claims c2 \n  JOIN policies p2 ON c2.policy_id = p2.id \n  WHERE c2.id = {{ $json.id }}\n)\n  AND c.id != {{ $json.id }}\n  AND c.created_at >= NOW() - INTERVAL '90 days'\nORDER BY c.created_at DESC",
        "options": {}
      },
      "id": "get-customer-history",
      "name": "ğŸ“œ ê³ ê° ì²­êµ¬ ì´ë ¥ ì¡°íšŒ",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [1100, 300],
      "credentials": {
        "postgres": {
          "id": "postgres-db",
          "name": "InsurTech DB"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=SELECT \n  COUNT(*) as claim_count,\n  hospital_name,\n  SUM(total_medical_expense) as total_amount\nFROM claims c\nJOIN policies p ON c.policy_id = p.id\nWHERE p.customer_id = (\n  SELECT p2.customer_id \n  FROM claims c2 \n  JOIN policies p2 ON c2.policy_id = p2.id \n  WHERE c2.id = {{ $json.id }}\n)\nGROUP BY hospital_name\nORDER BY claim_count DESC",
        "options": {}
      },
      "id": "get-hospital-pattern",
      "name": "ğŸ¥ ë³‘ì› ì´ìš© íŒ¨í„´ ì¡°íšŒ",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [1100, 500],
      "credentials": {
        "postgres": {
          "id": "postgres-db",
          "name": "InsurTech DB"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "id": "merge-patterns",
      "name": "ğŸ”— íŒ¨í„´ ë°ì´í„° ë³‘í•©",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [1320, 400]
    },
    {
      "parameters": {
        "jsCode": "// ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„\nconst claim = $('ğŸ“¦ 10ê±´ì”© ë°°ì¹˜ ì²˜ë¦¬').item.json;\nconst history = $('ğŸ“œ ê³ ê° ì²­êµ¬ ì´ë ¥ ì¡°íšŒ').all().map(i => i.json);\nconst hospitalPattern = $('ğŸ¥ ë³‘ì› ì´ìš© íŒ¨í„´ ì¡°íšŒ').all().map(i => i.json);\n\nlet additionalScore = 0;\nconst newPatterns = [];\n\n// 1. ë‹¨ê¸°ë‹¤ìˆ˜ì²­êµ¬ ë¶„ì„ (7ì¼ ë‚´)\nconst recentClaims = history.filter(h => {\n  const daysDiff = (new Date() - new Date(h.created_at)) / (1000 * 60 * 60 * 24);\n  return daysDiff <= 7;\n});\nif (recentClaims.length >= 3) {\n  additionalScore += 20;\n  newPatterns.push({\n    pattern: 'FREQUENT_CLAIMS_7D',\n    name: 'ë‹¨ê¸°ë‹¤ìˆ˜ì²­êµ¬ (7ì¼)',\n    score: 20,\n    description: `7ì¼ ë‚´ ${recentClaims.length}ê±´ ì²­êµ¬`,\n    severity: 'HIGH'\n  });\n}\n\n// 2. ì§„ë‹¨ì½”ë“œ ë°˜ë³µ ë¶„ì„ (ë™ì¼ ì§„ë‹¨ 3íšŒ ì´ìƒ)\nconst diagnosisCounts = {};\nhistory.forEach(h => {\n  const code = h.diagnosis_code;\n  diagnosisCounts[code] = (diagnosisCounts[code] || 0) + 1;\n});\nconst repeatedDiagnosis = Object.entries(diagnosisCounts)\n  .filter(([code, count]) => count >= 3);\nif (repeatedDiagnosis.length > 0) {\n  additionalScore += 15;\n  newPatterns.push({\n    pattern: 'REPEATED_DIAGNOSIS',\n    name: 'ì§„ë‹¨ì½”ë“œ ë°˜ë³µ',\n    score: 15,\n    description: `ë™ì¼ ì§„ë‹¨ ë°˜ë³µ: ${repeatedDiagnosis.map(([c,n]) => `${c}(${n}íšŒ)`).join(', ')}`,\n    severity: 'MEDIUM'\n  });\n}\n\n// 3. ë³‘ì› ì§‘ì¤‘ë„ ë¶„ì„ (80% ì´ìƒ í•œ ë³‘ì›)\nconst totalClaims = hospitalPattern.reduce((sum, h) => sum + parseInt(h.claim_count), 0);\nconst maxHospital = hospitalPattern[0];\nif (maxHospital && totalClaims > 0) {\n  const concentration = (parseInt(maxHospital.claim_count) / totalClaims) * 100;\n  if (concentration >= 80) {\n    additionalScore += 15;\n    newPatterns.push({\n      pattern: 'HOSPITAL_CONCENTRATION',\n      name: 'ë³‘ì› ì§‘ì¤‘ë„',\n      score: 15,\n      description: `${maxHospital.hospital_name}ì— ${concentration.toFixed(1)}% ì§‘ì¤‘`,\n      severity: 'MEDIUM'\n    });\n  }\n}\n\n// 4. ê¸ˆì•¡ ê¸‰ì¦ ë¶„ì„\nconst avgAmount = history.length > 0 \n  ? history.reduce((sum, h) => sum + parseFloat(h.total_medical_expense || 0), 0) / history.length\n  : 0;\nif (avgAmount > 0 && claim.total_medical_expense > avgAmount * 3) {\n  additionalScore += 25;\n  newPatterns.push({\n    pattern: 'AMOUNT_SPIKE',\n    name: 'ê¸ˆì•¡ ê¸‰ì¦',\n    score: 25,\n    description: `í‰ê· (${Math.round(avgAmount).toLocaleString()}ì›)ì˜ ${(claim.total_medical_expense / avgAmount).toFixed(1)}ë°°`,\n    severity: 'HIGH'\n  });\n}\n\n// 5. ì—°ì† ì…ì› íŒ¨í„´\nlet consecutiveAdmissions = 0;\nfor (let i = 0; i < history.length - 1; i++) {\n  const curr = new Date(history[i].treatment_start_date);\n  const next = new Date(history[i + 1].treatment_start_date);\n  const daysDiff = (curr - next) / (1000 * 60 * 60 * 24);\n  if (daysDiff <= 14) consecutiveAdmissions++;\n}\nif (consecutiveAdmissions >= 3) {\n  additionalScore += 15;\n  newPatterns.push({\n    pattern: 'CONSECUTIVE_ADMISSIONS',\n    name: 'ì—°ì† ì…ì›',\n    score: 15,\n    description: `14ì¼ ê°„ê²© ì´ë‚´ ì—°ì† ${consecutiveAdmissions + 1}íšŒ ì…ì›`,\n    severity: 'MEDIUM'\n  });\n}\n\n// ìµœì¢… ì ìˆ˜ ê³„ì‚°\nconst originalScore = claim.fraud_score || 0;\nconst totalScore = Math.min(100, originalScore + additionalScore);\n\n// ìœ„í—˜ ë“±ê¸‰ ì¬ì‚°ì •\nlet riskLevel = 'LOW';\nlet recommendedAction = 'APPROVE';\nif (totalScore >= 76) {\n  riskLevel = 'CRITICAL';\n  recommendedAction = 'REJECT';\n} else if (totalScore >= 51) {\n  riskLevel = 'HIGH';\n  recommendedAction = 'INVESTIGATE';\n} else if (totalScore >= 31) {\n  riskLevel = 'MEDIUM';\n  recommendedAction = 'REVIEW';\n}\n\nreturn {\n  claimId: claim.id,\n  claimNumber: claim.claim_number,\n  customerName: claim.customer_name,\n  originalScore: originalScore,\n  additionalScore: additionalScore,\n  totalScore: totalScore,\n  riskLevel: riskLevel,\n  recommendedAction: recommendedAction,\n  newPatterns: newPatterns,\n  historyCount: history.length,\n  hospitalCount: hospitalPattern.length,\n  analyzedAt: new Date().toISOString()\n};"
      },
      "id": "analyze-patterns",
      "name": "ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1540, 400]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "score-changed",
              "leftValue": "={{ $json.additionalScore }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "if-score-changed",
      "name": "ğŸ”€ ì ìˆ˜ ë³€ê²½?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1760, 400]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=UPDATE claims \nSET \n  fraud_score = {{ $json.totalScore }},\n  fraud_risk_level = '{{ $json.riskLevel }}',\n  updated_at = NOW()\nWHERE id = {{ $json.claimId }}",
        "options": {}
      },
      "id": "update-fraud-score",
      "name": "ğŸ’¾ ì‚¬ê¸°ì ìˆ˜ ì—…ë°ì´íŠ¸",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [1980, 300],
      "credentials": {
        "postgres": {
          "id": "postgres-db",
          "name": "InsurTech DB"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=INSERT INTO fraud_detection_results \n  (claim_id, total_score, risk_level, detected_patterns, recommended_action, analyzed_at)\nVALUES \n  ({{ $json.claimId }}, {{ $json.totalScore }}, '{{ $json.riskLevel }}', \n   '{{ JSON.stringify($json.newPatterns).replace(/'/g, \"''\") }}', \n   '{{ $json.recommendedAction }}', NOW())\nON CONFLICT (claim_id) \nDO UPDATE SET\n  total_score = EXCLUDED.total_score,\n  risk_level = EXCLUDED.risk_level,\n  detected_patterns = EXCLUDED.detected_patterns,\n  recommended_action = EXCLUDED.recommended_action,\n  analyzed_at = NOW()",
        "options": {}
      },
      "id": "save-detection-result",
      "name": "ğŸ’¾ íƒì§€ ê²°ê³¼ ì €ì¥",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [2200, 300],
      "credentials": {
        "postgres": {
          "id": "postgres-db",
          "name": "InsurTech DB"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.riskLevel }}",
                    "rightValue": "CRITICAL",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "CRITICAL"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.riskLevel }}",
                    "rightValue": "HIGH",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "HIGH"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "switch-risk-level",
      "name": "ğŸ”€ ìœ„í—˜ë„ ë¶„ê¸°",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [2420, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=http://insurtech-api:3000/api/fraud/siu-referral/{{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.claimId }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"referralReason\": \"ì¼ì¼ ì‚¬ê¸° íƒì§€ ë¶„ì„ ê²°ê³¼ CRITICAL ë“±ê¸‰\",\n  \"totalScore\": {{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.totalScore }},\n  \"detectedPatterns\": {{ JSON.stringify($('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.newPatterns) }},\n  \"priority\": \"URGENT\",\n  \"source\": \"n8n-daily-fraud-analysis\"\n}",
        "options": {}
      },
      "id": "siu-referral",
      "name": "ğŸš” SIU ì¡°ì‚¬ ì˜ë¢°",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2640, 200],
      "credentials": {
        "httpHeaderAuth": {
          "id": "jwt-token",
          "name": "JWT Token"
        }
      }
    },
    {
      "parameters": {
        "channel": "#insurance-fraud-alert",
        "text": "=ğŸš” *[CRITICAL] SIU ì¡°ì‚¬ ì˜ë¢°*\n\nì²­êµ¬ë²ˆí˜¸: {{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.claimNumber }}\nê³ ê°ëª…: {{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.customerName }}\n\nğŸ”´ ì‚¬ê¸°ì ìˆ˜: {{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.originalScore }} â†’ *{{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.totalScore }}ì * (+{{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.additionalScore }})\n\n*ìƒˆë¡œ íƒì§€ëœ íŒ¨í„´:*\n{{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.newPatterns.map(p => 'â€¢ ' + p.name + ' (+' + p.score + 'ì ): ' + p.description).join('\\n') }}\n\nâš ï¸ ì¦‰ì‹œ SIUíŒ€ ì¡°ì‚¬ ì°©ìˆ˜ í•„ìš”\n@here @siu-team",
        "otherOptions": {}
      },
      "id": "slack-critical",
      "name": "ğŸ“± Slack (CRITICAL)",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [2860, 200],
      "credentials": {
        "slackApi": {
          "id": "slack-bot",
          "name": "Slack Bot"
        }
      }
    },
    {
      "parameters": {
        "channel": "#insurance-fraud-alert",
        "text": "=ğŸš¨ *[HIGH] ê³ ìœ„í—˜ ì²­êµ¬ ê°ì§€*\n\nì²­êµ¬ë²ˆí˜¸: {{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.claimNumber }}\nê³ ê°ëª…: {{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.customerName }}\n\nğŸ”´ ì‚¬ê¸°ì ìˆ˜: {{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.originalScore }} â†’ *{{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.totalScore }}ì * (+{{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.additionalScore }})\n\n*ìƒˆë¡œ íƒì§€ëœ íŒ¨í„´:*\n{{ $('ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„').item.json.newPatterns.map(p => 'â€¢ ' + p.name + ' (+' + p.score + 'ì ): ' + p.description).join('\\n') }}\n\në¶€ì¥ê¸‰ ì´ìƒ ê²€í†  í•„ìš”",
        "otherOptions": {}
      },
      "id": "slack-high",
      "name": "ğŸ“± Slack (HIGH)",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [2640, 400],
      "credentials": {
        "slackApi": {
          "id": "slack-bot",
          "name": "Slack Bot"
        }
      }
    },
    {
      "parameters": {
        "loopScoped": false
      },
      "id": "loop-back",
      "name": "ğŸ”„ ë‹¤ìŒ ë°°ì¹˜",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [2860, 400]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  COUNT(*) as total_analyzed,\n  COUNT(CASE WHEN fraud_risk_level = 'CRITICAL' THEN 1 END) as critical_count,\n  COUNT(CASE WHEN fraud_risk_level = 'HIGH' THEN 1 END) as high_count,\n  COUNT(CASE WHEN fraud_risk_level = 'MEDIUM' THEN 1 END) as medium_count,\n  COUNT(CASE WHEN fraud_risk_level = 'LOW' THEN 1 END) as low_count,\n  AVG(fraud_score) as avg_score,\n  MAX(fraud_score) as max_score\nFROM claims\nWHERE created_at >= NOW() - INTERVAL '24 hours'",
        "options": {}
      },
      "id": "get-daily-stats",
      "name": "ğŸ“Š ì¼ì¼ í†µê³„ ì§‘ê³„",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [3080, 300],
      "credentials": {
        "postgres": {
          "id": "postgres-db",
          "name": "InsurTech DB"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  hospital_name,\n  COUNT(*) as claim_count,\n  AVG(fraud_score) as avg_fraud_score,\n  SUM(total_medical_expense) as total_amount\nFROM claims\nWHERE created_at >= NOW() - INTERVAL '30 days'\n  AND fraud_score >= 50\nGROUP BY hospital_name\nHAVING COUNT(*) >= 3\nORDER BY avg_fraud_score DESC\nLIMIT 10",
        "options": {}
      },
      "id": "get-suspicious-hospitals",
      "name": "ğŸ¥ ì˜ì‹¬ ë³‘ì› ë¶„ì„",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [3080, 500],
      "credentials": {
        "postgres": {
          "id": "postgres-db",
          "name": "InsurTech DB"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "id": "merge-report",
      "name": "ğŸ”— ë¦¬í¬íŠ¸ ë°ì´í„° ë³‘í•©",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [3300, 400]
    },
    {
      "parameters": {
        "jsCode": "// ì¼ì¼ ì‚¬ê¸° íƒì§€ ë¦¬í¬íŠ¸ ìƒì„±\nconst stats = $('ğŸ“Š ì¼ì¼ í†µê³„ ì§‘ê³„').first().json;\nconst hospitals = $('ğŸ¥ ì˜ì‹¬ ë³‘ì› ë¶„ì„').all().map(i => i.json);\nconst today = new Date().toLocaleDateString('ko-KR');\n\nconst report = {\n  reportDate: today,\n  generatedAt: new Date().toISOString(),\n  summary: {\n    totalAnalyzed: parseInt(stats.total_analyzed) || 0,\n    criticalCount: parseInt(stats.critical_count) || 0,\n    highCount: parseInt(stats.high_count) || 0,\n    mediumCount: parseInt(stats.medium_count) || 0,\n    lowCount: parseInt(stats.low_count) || 0,\n    avgScore: parseFloat(stats.avg_score)?.toFixed(1) || '0',\n    maxScore: parseInt(stats.max_score) || 0\n  },\n  riskDistribution: {\n    critical: ((parseInt(stats.critical_count) || 0) / (parseInt(stats.total_analyzed) || 1) * 100).toFixed(1) + '%',\n    high: ((parseInt(stats.high_count) || 0) / (parseInt(stats.total_analyzed) || 1) * 100).toFixed(1) + '%',\n    medium: ((parseInt(stats.medium_count) || 0) / (parseInt(stats.total_analyzed) || 1) * 100).toFixed(1) + '%',\n    low: ((parseInt(stats.low_count) || 0) / (parseInt(stats.total_analyzed) || 1) * 100).toFixed(1) + '%'\n  },\n  suspiciousHospitals: hospitals.map(h => ({\n    name: h.hospital_name,\n    claimCount: parseInt(h.claim_count),\n    avgFraudScore: parseFloat(h.avg_fraud_score).toFixed(1),\n    totalAmount: parseInt(h.total_amount).toLocaleString() + 'ì›'\n  })),\n  alerts: []\n};\n\n// ê²½ê³  ìƒì„±\nif (report.summary.criticalCount > 0) {\n  report.alerts.push(`ğŸš¨ CRITICAL ë“±ê¸‰ ${report.summary.criticalCount}ê±´ - ì¦‰ì‹œ SIU ê²€í†  í•„ìš”`);\n}\nif (report.summary.highCount >= 5) {\n  report.alerts.push(`âš ï¸ HIGH ë“±ê¸‰ ${report.summary.highCount}ê±´ - ë¶€ì¥ê¸‰ ê²€í†  ê¶Œì¥`);\n}\nif (parseFloat(stats.avg_score) > 40) {\n  report.alerts.push(`ğŸ“ˆ í‰ê·  ì‚¬ê¸°ì ìˆ˜ ${stats.avg_score}ì  - ì „ë°˜ì  ìœ„í—˜ë„ ìƒìŠ¹`);\n}\nif (hospitals.length >= 3) {\n  report.alerts.push(`ğŸ¥ ì˜ì‹¬ ë³‘ì› ${hospitals.length}ê³³ íƒì§€ - ë„¤íŠ¸ì›Œí¬ ë¶„ì„ ê¶Œì¥`);\n}\n\nreturn report;"
      },
      "id": "generate-report",
      "name": "ğŸ“ ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3520, 400]
    },
    {
      "parameters": {
        "channel": "#insurance-fraud-report",
        "text": "=ğŸ“Š *ì¼ì¼ ì‚¬ê¸° íƒì§€ ë¦¬í¬íŠ¸* ({{ $json.reportDate }})\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“ˆ *ë¶„ì„ ìš”ì•½*\nâ€¢ ì´ ë¶„ì„ ê±´ìˆ˜: {{ $json.summary.totalAnalyzed }}ê±´\nâ€¢ í‰ê·  ì‚¬ê¸°ì ìˆ˜: {{ $json.summary.avgScore }}ì \nâ€¢ ìµœê³  ì‚¬ê¸°ì ìˆ˜: {{ $json.summary.maxScore }}ì \n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ¯ *ìœ„í—˜ë„ ë¶„í¬*\nğŸ”´ CRITICAL: {{ $json.summary.criticalCount }}ê±´ ({{ $json.riskDistribution.critical }})\nğŸŸ  HIGH: {{ $json.summary.highCount }}ê±´ ({{ $json.riskDistribution.high }})\nğŸŸ¡ MEDIUM: {{ $json.summary.mediumCount }}ê±´ ({{ $json.riskDistribution.medium }})\nğŸŸ¢ LOW: {{ $json.summary.lowCount }}ê±´ ({{ $json.riskDistribution.low }})\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ¥ *ì˜ì‹¬ ë³‘ì› TOP 5*\n{{ $json.suspiciousHospitals.slice(0,5).map((h, i) => (i+1) + '. ' + h.name + ' - í‰ê·  ' + h.avgFraudScore + 'ì  (' + h.claimCount + 'ê±´)').join('\\n') || 'ì—†ìŒ' }}\n\n{{ $json.alerts.length > 0 ? 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nâš ï¸ *ê²½ê³ *\\n' + $json.alerts.join('\\n') : '' }}",
        "otherOptions": {}
      },
      "id": "slack-daily-report",
      "name": "ğŸ“± Slack ì¼ì¼ ë¦¬í¬íŠ¸",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [3740, 300],
      "credentials": {
        "slackApi": {
          "id": "slack-bot",
          "name": "Slack Bot"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "fraud-detection@insurtech.co.kr",
        "toEmail": "siu-team@insurtech.co.kr, risk-management@insurtech.co.kr",
        "subject": "=[InsurTech] ì¼ì¼ ì‚¬ê¸° íƒì§€ ë¦¬í¬íŠ¸ - {{ $json.reportDate }}",
        "emailType": "html",
        "html": "=<h2>ğŸ“Š ì¼ì¼ ì‚¬ê¸° íƒì§€ ë¦¬í¬íŠ¸</h2>\n<p>ë‚ ì§œ: {{ $json.reportDate }}</p>\n<hr>\n\n<h3>ğŸ“ˆ ë¶„ì„ ìš”ì•½</h3>\n<table border=\"1\" cellpadding=\"8\" style=\"border-collapse: collapse;\">\n<tr><td>ì´ ë¶„ì„ ê±´ìˆ˜</td><td><strong>{{ $json.summary.totalAnalyzed }}ê±´</strong></td></tr>\n<tr><td>í‰ê·  ì‚¬ê¸°ì ìˆ˜</td><td>{{ $json.summary.avgScore }}ì </td></tr>\n<tr><td>ìµœê³  ì‚¬ê¸°ì ìˆ˜</td><td>{{ $json.summary.maxScore }}ì </td></tr>\n</table>\n\n<h3>ğŸ¯ ìœ„í—˜ë„ ë¶„í¬</h3>\n<table border=\"1\" cellpadding=\"8\" style=\"border-collapse: collapse;\">\n<tr style=\"background-color: #ffcccc;\"><td>ğŸ”´ CRITICAL</td><td>{{ $json.summary.criticalCount }}ê±´</td><td>{{ $json.riskDistribution.critical }}</td></tr>\n<tr style=\"background-color: #ffe6cc;\"><td>ğŸŸ  HIGH</td><td>{{ $json.summary.highCount }}ê±´</td><td>{{ $json.riskDistribution.high }}</td></tr>\n<tr style=\"background-color: #ffffcc;\"><td>ğŸŸ¡ MEDIUM</td><td>{{ $json.summary.mediumCount }}ê±´</td><td>{{ $json.riskDistribution.medium }}</td></tr>\n<tr style=\"background-color: #ccffcc;\"><td>ğŸŸ¢ LOW</td><td>{{ $json.summary.lowCount }}ê±´</td><td>{{ $json.riskDistribution.low }}</td></tr>\n</table>\n\n<h3>ğŸ¥ ì˜ì‹¬ ë³‘ì› (ìµœê·¼ 30ì¼)</h3>\n<table border=\"1\" cellpadding=\"8\" style=\"border-collapse: collapse;\">\n<tr><th>ìˆœìœ„</th><th>ë³‘ì›ëª…</th><th>ì²­êµ¬ ê±´ìˆ˜</th><th>í‰ê·  ì‚¬ê¸°ì ìˆ˜</th><th>ì´ ì²­êµ¬ì•¡</th></tr>\n{{ $json.suspiciousHospitals.map((h, i) => '<tr><td>' + (i+1) + '</td><td>' + h.name + '</td><td>' + h.claimCount + 'ê±´</td><td>' + h.avgFraudScore + 'ì </td><td>' + h.totalAmount + '</td></tr>').join('') }}\n</table>\n\n{{ $json.alerts.length > 0 ? '<h3>âš ï¸ ê²½ê³ </h3><ul>' + $json.alerts.map(a => '<li>' + a + '</li>').join('') + '</ul>' : '' }}\n\n<hr>\n<p style=\"color: gray;\">ì´ ë¦¬í¬íŠ¸ëŠ” ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. (ìƒì„± ì‹œê°: {{ $json.generatedAt }})</p>",
        "options": {}
      },
      "id": "email-daily-report",
      "name": "ğŸ“§ ì´ë©”ì¼ ë¦¬í¬íŠ¸",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [3740, 500],
      "credentials": {
        "smtp": {
          "id": "smtp-config",
          "name": "SMTP"
        }
      }
    },
    {
      "parameters": {
        "operation": "set",
        "key": "fraud:daily-report:{{ new Date().toISOString().split('T')[0] }}",
        "value": "={{ JSON.stringify($json) }}",
        "expire": true,
        "ttl": 604800
      },
      "id": "cache-report",
      "name": "ğŸ’¾ Redis ìºì‹œ ì €ì¥",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [3960, 400],
      "credentials": {
        "redis": {
          "id": "redis-cache",
          "name": "InsurTech Redis"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://insurtech-api:3000/api/audit",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"entityType\": \"FRAUD_ANALYSIS\",\n  \"entityId\": 0,\n  \"action\": \"DAILY_ANALYSIS\",\n  \"userId\": 1,\n  \"details\": {\n    \"source\": \"n8n-scheduled-workflow\",\n    \"reportDate\": \"{{ $('ğŸ“ ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„±').item.json.reportDate }}\",\n    \"totalAnalyzed\": {{ $('ğŸ“ ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„±').item.json.summary.totalAnalyzed }},\n    \"criticalCount\": {{ $('ğŸ“ ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„±').item.json.summary.criticalCount }},\n    \"highCount\": {{ $('ğŸ“ ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„±').item.json.summary.highCount }}\n  }\n}",
        "options": {}
      },
      "id": "audit-log",
      "name": "ğŸ“ ê°ì‚¬ ë¡œê·¸",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [4180, 400],
      "credentials": {
        "httpHeaderAuth": {
          "id": "jwt-token",
          "name": "JWT Token"
        }
      }
    }
  ],
  "connections": {
    "â° ë§¤ì¼ 02:00 ì‹¤í–‰": {
      "main": [
        [
          {
            "node": "ğŸ” ì‹œìŠ¤í…œ ë¡œê·¸ì¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¥ ìˆ˜ë™ ë¶„ì„ íŠ¸ë¦¬ê±°": {
      "main": [
        [
          {
            "node": "ğŸ” ì‹œìŠ¤í…œ ë¡œê·¸ì¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” ì‹œìŠ¤í…œ ë¡œê·¸ì¸": {
      "main": [
        [
          {
            "node": "ğŸ“Š ìµœê·¼ 24ì‹œê°„ ì²­êµ¬ ì¡°íšŒ",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ”´ ê³ ìœ„í—˜ ì²­êµ¬ ì¡°íšŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š ìµœê·¼ 24ì‹œê°„ ì²­êµ¬ ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "ğŸ”— ì²­êµ¬ ë°ì´í„° ë³‘í•©",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”´ ê³ ìœ„í—˜ ì²­êµ¬ ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "ğŸ”— ì²­êµ¬ ë°ì´í„° ë³‘í•©",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ğŸ”— ì²­êµ¬ ë°ì´í„° ë³‘í•©": {
      "main": [
        [
          {
            "node": "ğŸ“¦ 10ê±´ì”© ë°°ì¹˜ ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¦ 10ê±´ì”© ë°°ì¹˜ ì²˜ë¦¬": {
      "main": [
        [
          {
            "node": "ğŸ“œ ê³ ê° ì²­êµ¬ ì´ë ¥ ì¡°íšŒ",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ¥ ë³‘ì› ì´ìš© íŒ¨í„´ ì¡°íšŒ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“Š ì¼ì¼ í†µê³„ ì§‘ê³„",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ¥ ì˜ì‹¬ ë³‘ì› ë¶„ì„",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“œ ê³ ê° ì²­êµ¬ ì´ë ¥ ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "ğŸ”— íŒ¨í„´ ë°ì´í„° ë³‘í•©",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¥ ë³‘ì› ì´ìš© íŒ¨í„´ ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "ğŸ”— íŒ¨í„´ ë°ì´í„° ë³‘í•©",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ğŸ”— íŒ¨í„´ ë°ì´í„° ë³‘í•©": {
      "main": [
        [
          {
            "node": "ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” ì‚¬ê¸° íŒ¨í„´ ì‹¬ì¸µ ë¶„ì„": {
      "main": [
        [
          {
            "node": "ğŸ”€ ì ìˆ˜ ë³€ê²½?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ ì ìˆ˜ ë³€ê²½?": {
      "main": [
        [
          {
            "node": "ğŸ’¾ ì‚¬ê¸°ì ìˆ˜ ì—…ë°ì´íŠ¸",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ”„ ë‹¤ìŒ ë°°ì¹˜",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ ì‚¬ê¸°ì ìˆ˜ ì—…ë°ì´íŠ¸": {
      "main": [
        [
          {
            "node": "ğŸ’¾ íƒì§€ ê²°ê³¼ ì €ì¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ íƒì§€ ê²°ê³¼ ì €ì¥": {
      "main": [
        [
          {
            "node": "ğŸ”€ ìœ„í—˜ë„ ë¶„ê¸°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ ìœ„í—˜ë„ ë¶„ê¸°": {
      "main": [
        [
          {
            "node": "ğŸš” SIU ì¡°ì‚¬ ì˜ë¢°",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“± Slack (HIGH)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ”„ ë‹¤ìŒ ë°°ì¹˜",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸš” SIU ì¡°ì‚¬ ì˜ë¢°": {
      "main": [
        [
          {
            "node": "ğŸ“± Slack (CRITICAL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“± Slack (CRITICAL)": {
      "main": [
        [
          {
            "node": "ğŸ”„ ë‹¤ìŒ ë°°ì¹˜",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“± Slack (HIGH)": {
      "main": [
        [
          {
            "node": "ğŸ”„ ë‹¤ìŒ ë°°ì¹˜",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”„ ë‹¤ìŒ ë°°ì¹˜": {
      "main": [
        [
          {
            "node": "ğŸ“œ ê³ ê° ì²­êµ¬ ì´ë ¥ ì¡°íšŒ",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ¥ ë³‘ì› ì´ìš© íŒ¨í„´ ì¡°íšŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š ì¼ì¼ í†µê³„ ì§‘ê³„": {
      "main": [
        [
          {
            "node": "ğŸ”— ë¦¬í¬íŠ¸ ë°ì´í„° ë³‘í•©",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¥ ì˜ì‹¬ ë³‘ì› ë¶„ì„": {
      "main": [
        [
          {
            "node": "ğŸ”— ë¦¬í¬íŠ¸ ë°ì´í„° ë³‘í•©",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ğŸ”— ë¦¬í¬íŠ¸ ë°ì´í„° ë³‘í•©": {
      "main": [
        [
          {
            "node": "ğŸ“ ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„±": {
      "main": [
        [
          {
            "node": "ğŸ“± Slack ì¼ì¼ ë¦¬í¬íŠ¸",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“§ ì´ë©”ì¼ ë¦¬í¬íŠ¸",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ’¾ Redis ìºì‹œ ì €ì¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ Redis ìºì‹œ ì €ì¥": {
      "main": [
        [
          {
            "node": "ğŸ“ ê°ì‚¬ ë¡œê·¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "3",
  "meta": {
    "instanceId": "insurtech-n8n"
  },
  "tags": [
    {
      "name": "ì‚¬ê¸°íƒì§€",
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z"
    },
    {
      "name": "ìŠ¤ì¼€ì¤„",
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z"
    }
  ]
}
