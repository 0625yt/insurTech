<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InsurTech Enterprise - 보험금 청구 심사 시스템</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #764ba2;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --dark: #1f2937;
            --gray: #6b7280;
            --light: #f3f4f6;
            --white: #ffffff;
            --sidebar-width: 260px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(180deg, var(--dark) 0%, #111827 100%);
            padding: 0;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h1 {
            color: var(--white);
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .sidebar-header span {
            color: var(--primary);
            font-size: 0.75rem;
            background: rgba(102, 126, 234, 0.2);
            padding: 3px 8px;
            border-radius: 4px;
        }

        .sidebar-nav {
            padding: 15px 0;
        }

        .nav-section {
            margin-bottom: 20px;
        }

        .nav-section-title {
            color: var(--gray);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 10px 20px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #9ca3af;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
            gap: 12px;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--white);
        }

        .nav-item.active {
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--white);
            border-left: 3px solid var(--white);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        .nav-item .badge {
            margin-left: auto;
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--white);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-left h2 {
            color: var(--dark);
            font-size: 1.3rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification-btn {
            position: relative;
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            color: var(--gray);
            font-size: 1.2rem;
        }

        .notification-btn .count {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--danger);
            color: white;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 10px;
            transition: background 0.3s;
        }

        .user-menu:hover {
            background: var(--light);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .user-info {
            text-align: left;
        }

        .user-info .name {
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }

        .user-info .role {
            color: var(--gray);
            font-size: 0.75rem;
        }

        /* User Dropdown */
        .user-menu-container {
            position: relative;
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--white);
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            padding: 10px 0;
            z-index: 1000;
            display: none;
            margin-top: 5px;
        }

        .user-dropdown.show {
            display: block;
        }

        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: var(--gray);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .user-dropdown-item:hover {
            background: var(--light);
            color: var(--dark);
        }

        .user-dropdown-item i {
            width: 20px;
            text-align: center;
        }

        .user-dropdown-item.danger {
            color: var(--danger);
        }

        .user-dropdown-item.danger:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        .user-dropdown-divider {
            border-top: 1px solid var(--light);
            margin: 8px 0;
        }

        /* AI Model Comparison */
        .ai-model-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .ai-model-card {
            background: var(--white);
            border: 2px solid var(--light);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
        }

        .ai-model-card:hover {
            border-color: var(--primary);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.15);
        }

        .ai-model-card.selected {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }

        .ai-model-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .ai-model-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--dark);
        }

        .ai-model-provider {
            font-size: 0.75rem;
            color: var(--gray);
            background: var(--light);
            padding: 3px 8px;
            border-radius: 4px;
        }

        .ai-model-score {
            font-size: 2rem;
            font-weight: 700;
            margin: 15px 0;
        }

        .ai-model-score.high { color: var(--success); }
        .ai-model-score.medium { color: var(--warning); }
        .ai-model-score.low { color: var(--danger); }

        .ai-model-amounts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            background: var(--light);
            border-radius: 10px;
        }

        .ai-amount-item label {
            font-size: 0.75rem;
            color: var(--gray);
            display: block;
            margin-bottom: 3px;
        }

        .ai-amount-item .value {
            font-weight: 600;
            color: var(--dark);
        }

        .ai-amount-item .value.approved { color: var(--success); }
        .ai-amount-item .value.rejected { color: var(--danger); }

        .ai-model-reasoning {
            font-size: 0.85rem;
            color: var(--gray);
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
            margin-top: 15px;
        }

        /* Coverage Analysis */
        .coverage-item {
            background: var(--white);
            border: 1px solid var(--light);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .coverage-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .coverage-item-title {
            font-weight: 600;
            color: var(--dark);
            font-size: 1rem;
        }

        .coverage-term-ref {
            font-size: 0.75rem;
            color: var(--primary);
            background: rgba(102, 126, 234, 0.1);
            padding: 4px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .coverage-calculation {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .coverage-amounts {
            display: flex;
            gap: 30px;
        }

        .coverage-amount {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .coverage-amount .label {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .coverage-amount .value {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .coverage-amount .value.approved { color: var(--success); }
        .coverage-amount .value.rejected { color: var(--danger); }

        /* Policy Terms Popup */
        .term-detail {
            background: var(--light);
            border-left: 4px solid var(--primary);
            padding: 20px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
        }

        .term-detail h5 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .term-detail .formula {
            font-family: monospace;
            background: var(--white);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }

        /* Editable Fields for Adjuster */
        .adjuster-section {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .adjuster-section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #92400e;
            font-weight: 700;
        }

        .editable-field {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--white);
            border-radius: 8px;
            margin-bottom: 10px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .editable-field:hover {
            border-color: var(--primary);
        }

        .editable-field.modified {
            border-color: var(--warning);
            background: #fffbeb;
        }

        .editable-field label {
            flex: 0 0 150px;
            font-weight: 600;
            color: var(--dark);
        }

        .editable-field .original-value {
            flex: 0 0 120px;
            color: var(--gray);
            text-decoration: line-through;
            font-size: 0.85rem;
        }

        .editable-field input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid var(--light);
            border-radius: 6px;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .editable-field input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .editable-field .ai-source {
            flex: 0 0 auto;
            font-size: 0.75rem;
            color: var(--info);
            cursor: pointer;
            padding: 4px 8px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 4px;
        }

        .editable-field .ai-source:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        /* Evidence Panel */
        .evidence-panel {
            background: #f0f9ff;
            border-left: 4px solid var(--info);
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
            display: none;
        }

        .evidence-panel.show {
            display: block;
        }

        .evidence-panel h5 {
            color: var(--info);
            margin-bottom: 10px;
        }

        .evidence-item {
            background: var(--white);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .evidence-item .source {
            color: var(--gray);
            font-size: 0.75rem;
        }

        /* Change Summary */
        .change-summary {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 2px solid var(--info);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .change-summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .change-summary-title {
            font-weight: 700;
            color: var(--info);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .change-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: var(--white);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .change-row .item-name {
            font-weight: 500;
        }

        .change-row .values {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .change-row .original {
            color: var(--gray);
            text-decoration: line-through;
        }

        .change-row .arrow {
            color: var(--warning);
        }

        .change-row .modified {
            color: var(--success);
            font-weight: 700;
        }

        .change-row .diff {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .change-row .diff.positive {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .change-row .diff.negative {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        /* Total Calculation */
        .total-calculation {
            background: var(--dark);
            color: var(--white);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .total-row:last-child {
            border-bottom: none;
            font-size: 1.3rem;
            font-weight: 700;
            padding-top: 15px;
        }

        .total-row .label {
            color: rgba(255,255,255,0.7);
        }

        .total-row .value {
            font-weight: 600;
        }

        .total-row .value.highlight {
            color: #10b981;
        }

        /* Recalculate Button */
        .btn-recalculate {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 12px 24px;
            font-weight: 600;
        }

        .btn-recalculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }

        /* Factor Slider */
        .factor-slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .factor-slider {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #10b981 0%, #f59e0b 50%, #ef4444 100%);
            outline: none;
        }

        .factor-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--white);
            border: 3px solid var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .factor-value-display {
            min-width: 60px;
            text-align: center;
            font-weight: 700;
            font-size: 1.1rem;
        }

        /* Content */
        .content {
            padding: 30px;
        }

        /* Page */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--white);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .stat-card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }

        .stat-card-icon.blue { background: rgba(59, 130, 246, 0.1); color: var(--info); }
        .stat-card-icon.green { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .stat-card-icon.yellow { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .stat-card-icon.red { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .stat-card-icon.purple { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; }

        .stat-card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
        }

        .stat-card-label {
            color: var(--gray);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .stat-card-change {
            font-size: 0.8rem;
            margin-top: 10px;
        }

        .stat-card-change.up { color: var(--success); }
        .stat-card-change.down { color: var(--danger); }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }

        .card-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h3 {
            font-size: 1.1rem;
            color: var(--dark);
        }

        .card-body {
            padding: 25px;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--light);
        }

        th {
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
            font-size: 0.85rem;
        }

        td {
            color: var(--gray);
            font-size: 0.9rem;
        }

        tbody tr:hover {
            background: #f9fafb;
        }

        /* Badges */
        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-success { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .badge-warning { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .badge-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .badge-info { background: rgba(59, 130, 246, 0.1); color: var(--info); }
        .badge-gray { background: var(--light); color: var(--gray); }
        .badge-purple { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-info { background: var(--info); color: white; }
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--light);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        select.form-control {
            cursor: pointer;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--white);
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.2rem;
            color: var(--dark);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--light);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Approval Flow */
        .approval-flow {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 20px;
            background: var(--light);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .approval-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 100px;
        }

        .approval-step-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .approval-step-icon.pending { background: var(--light); color: var(--gray); border: 2px dashed var(--gray); }
        .approval-step-icon.current { background: var(--info); color: white; animation: pulse 2s infinite; }
        .approval-step-icon.approved { background: var(--success); color: white; }
        .approval-step-icon.rejected { background: var(--danger); color: white; }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
        }

        .approval-step-label {
            font-size: 0.75rem;
            color: var(--gray);
            text-align: center;
        }

        .approval-step-name {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--dark);
        }

        .approval-arrow {
            color: var(--gray);
            font-size: 1.2rem;
        }

        /* Document Checklist */
        .document-checklist {
            list-style: none;
        }

        .document-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid var(--light);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .document-item:hover {
            border-color: var(--primary);
        }

        .document-item.required {
            border-left: 3px solid var(--danger);
        }

        .document-item.submitted {
            background: rgba(16, 185, 129, 0.05);
            border-color: var(--success);
        }

        .document-item.verified {
            background: rgba(16, 185, 129, 0.1);
        }

        .document-checkbox {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--light);
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .document-item.submitted .document-checkbox,
        .document-item.verified .document-checkbox {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .document-info {
            flex: 1;
        }

        .document-name {
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 4px;
        }

        .document-status {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .document-actions {
            display: flex;
            gap: 10px;
        }

        /* Fraud Score */
        .fraud-score-bar {
            height: 10px;
            background: var(--light);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .fraud-score-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .fraud-score-fill.low { background: var(--success); }
        .fraud-score-fill.medium { background: var(--warning); }
        .fraud-score-fill.high { background: var(--danger); }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--light);
        }

        .timeline-item {
            position: relative;
            padding-bottom: 25px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 5px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary);
        }

        .timeline-item.success::before { background: var(--success); }
        .timeline-item.warning::before { background: var(--warning); }
        .timeline-item.danger::before { background: var(--danger); }

        .timeline-time {
            font-size: 0.75rem;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .timeline-content {
            background: var(--light);
            padding: 15px;
            border-radius: 10px;
        }

        .timeline-title {
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .timeline-desc {
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--light);
            margin-bottom: 20px;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            color: var(--gray);
            font-weight: 500;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.3s;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Loading */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Filter Bar */
        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-bar .form-control {
            width: auto;
            min-width: 150px;
        }

        /* Progress */
        .progress {
            height: 8px;
            background: var(--light);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s;
        }

        /* Alert */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-info { background: rgba(59, 130, 246, 0.1); color: var(--info); }
        .alert-success { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .alert-warning { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .alert-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>InsurTech</h1>
            <span>Enterprise v4.0</span>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">메인</div>
                <a class="nav-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>대시보드</span>
                </a>
                <a class="nav-item" data-page="claims">
                    <i class="fas fa-file-medical"></i>
                    <span>청구 심사</span>
                    <span class="badge" id="newClaimsCount">0</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">결재</div>
                <a class="nav-item" data-page="approval-inbox">
                    <i class="fas fa-inbox"></i>
                    <span>결재함</span>
                    <span class="badge" id="pendingApprovalCount">0</span>
                </a>
                <a class="nav-item" data-page="approval-history">
                    <i class="fas fa-history"></i>
                    <span>결재 이력</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">검증</div>
                <a class="nav-item" data-page="documents">
                    <i class="fas fa-file-alt"></i>
                    <span>서류 관리</span>
                </a>
                <a class="nav-item" data-page="fraud">
                    <i class="fas fa-shield-alt"></i>
                    <span>사기 탐지</span>
                </a>
                <a class="nav-item" data-page="duplicate">
                    <i class="fas fa-copy"></i>
                    <span>중복보험</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">관리</div>
                <a class="nav-item" data-page="audit">
                    <i class="fas fa-clipboard-list"></i>
                    <span>감사 로그</span>
                </a>
                <a class="nav-item" data-page="stats">
                    <i class="fas fa-chart-bar"></i>
                    <span>통계</span>
                </a>
                <a class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>설정</span>
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h2 id="pageTitle">대시보드</h2>
            </div>
            <div class="header-right">
                <button class="notification-btn" onclick="showNotifications()">
                    <i class="fas fa-bell"></i>
                    <span class="count" id="notificationCount">3</span>
                </button>
                <div class="user-menu-container">
                    <div class="user-menu" onclick="toggleUserMenu()">
                        <div class="user-avatar" id="userAvatar">홍</div>
                        <div class="user-info">
                            <div class="name" id="userName">로딩중...</div>
                            <div class="role" id="userRole">-</div>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-dropdown-item" onclick="navigateTo('settings')">
                            <i class="fas fa-user-cog"></i>
                            <span>내 정보</span>
                        </div>
                        <div class="user-dropdown-item" onclick="navigateTo('settings')">
                            <i class="fas fa-key"></i>
                            <span>비밀번호 변경</span>
                        </div>
                        <div class="user-dropdown-divider"></div>
                        <div class="user-dropdown-item danger" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>로그아웃</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content -->
        <div class="content">
            <!-- Dashboard Page -->
            <div class="page active" id="page-dashboard">
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div>
                                <div class="stat-card-value" id="statTotalClaims">0</div>
                                <div class="stat-card-label">오늘 접수 건</div>
                            </div>
                            <div class="stat-card-icon blue">
                                <i class="fas fa-file-medical"></i>
                            </div>
                        </div>
                        <div class="stat-card-change up">
                            <i class="fas fa-arrow-up"></i> 12% 증가
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div>
                                <div class="stat-card-value" id="statPendingApproval">0</div>
                                <div class="stat-card-label">결재 대기</div>
                            </div>
                            <div class="stat-card-icon yellow">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                        <div class="stat-card-change">
                            <span style="color: var(--gray);">긴급 2건 포함</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div>
                                <div class="stat-card-value" id="statFraudAlert">0</div>
                                <div class="stat-card-label">사기 의심 건</div>
                            </div>
                            <div class="stat-card-icon red">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div class="stat-card-change down">
                            <i class="fas fa-arrow-down"></i> 5% 감소
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div>
                                <div class="stat-card-value" id="statCompletedToday">0</div>
                                <div class="stat-card-label">오늘 완료</div>
                            </div>
                            <div class="stat-card-icon green">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        <div class="stat-card-change up">
                            <i class="fas fa-arrow-up"></i> 8% 증가
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-list"></i> 최근 청구 건</h3>
                        <button class="btn btn-outline btn-sm" onclick="navigateTo('claims')">
                            전체 보기 <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>청구번호</th>
                                        <th>고객명</th>
                                        <th>진단명</th>
                                        <th>청구금액</th>
                                        <th>상태</th>
                                        <th>결재단계</th>
                                        <th>접수일</th>
                                    </tr>
                                </thead>
                                <tbody id="recentClaimsTable">
                                    <tr>
                                        <td colspan="7" style="text-align: center;">
                                            <div class="loading-spinner"></div> 로딩 중...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Claims Page -->
            <div class="page" id="page-claims">
                <div class="filter-bar">
                    <select class="form-control" id="claimStatusFilter">
                        <option value="">전체 상태</option>
                        <option value="PENDING">접수대기</option>
                        <option value="REVIEWING">심사중</option>
                        <option value="APPROVED">승인</option>
                        <option value="REJECTED">거절</option>
                    </select>
                    <input type="date" class="form-control" id="claimDateFrom" placeholder="시작일">
                    <input type="date" class="form-control" id="claimDateTo" placeholder="종료일">
                    <button class="btn btn-primary" onclick="filterClaims()">
                        <i class="fas fa-search"></i> 검색
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>청구 목록</h3>
                        <button class="btn btn-primary" onclick="showNewClaimModal()">
                            <i class="fas fa-plus"></i> 새 청구
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>청구번호</th>
                                        <th>고객명</th>
                                        <th>진단코드</th>
                                        <th>청구금액</th>
                                        <th>AI 권고</th>
                                        <th>사기위험</th>
                                        <th>서류</th>
                                        <th>상태</th>
                                        <th>액션</th>
                                    </tr>
                                </thead>
                                <tbody id="claimsTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Approval Inbox Page -->
            <div class="page" id="page-approval-inbox">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <span>결재 대기 건이 <strong id="inboxCount">0</strong>건 있습니다. 긴급 건을 먼저 처리해 주세요.</span>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>결재 대기함</h3>
                        <div class="filter-bar" style="margin: 0;">
                            <select class="form-control" id="approvalUrgencyFilter">
                                <option value="">전체 긴급도</option>
                                <option value="URGENT">긴급</option>
                                <option value="HIGH">높음</option>
                                <option value="NORMAL">보통</option>
                                <option value="LOW">낮음</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>청구번호</th>
                                        <th>고객명</th>
                                        <th>청구금액</th>
                                        <th>요청자</th>
                                        <th>긴급도</th>
                                        <th>요청일시</th>
                                        <th>액션</th>
                                    </tr>
                                </thead>
                                <tbody id="approvalInboxTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Approval History Page -->
            <div class="page" id="page-approval-history">
                <div class="card">
                    <div class="card-header">
                        <h3>결재 이력</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>청구번호</th>
                                        <th>결재액션</th>
                                        <th>처리금액</th>
                                        <th>처리일시</th>
                                        <th>코멘트</th>
                                    </tr>
                                </thead>
                                <tbody id="approvalHistoryTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documents Page -->
            <div class="page" id="page-documents">
                <div class="card">
                    <div class="card-header">
                        <h3>서류 검증 현황</h3>
                    </div>
                    <div class="card-body">
                        <div class="filter-bar">
                            <input type="text" class="form-control" placeholder="청구번호 검색" id="docClaimSearch">
                            <button class="btn btn-primary" onclick="searchDocuments()">
                                <i class="fas fa-search"></i> 검색
                            </button>
                        </div>

                        <div id="documentChecklistArea">
                            <p style="color: var(--gray); text-align: center; padding: 40px;">
                                청구번호를 검색하여 서류 체크리스트를 확인하세요.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fraud Detection Page -->
            <div class="page" id="page-fraud">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div>
                                <div class="stat-card-value" id="fraudHighRisk">0</div>
                                <div class="stat-card-label">고위험 건</div>
                            </div>
                            <div class="stat-card-icon red">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div>
                                <div class="stat-card-value" id="fraudMediumRisk">0</div>
                                <div class="stat-card-label">중위험 건</div>
                            </div>
                            <div class="stat-card-icon yellow">
                                <i class="fas fa-exclamation"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div>
                                <div class="stat-card-value" id="fraudSIU">0</div>
                                <div class="stat-card-label">SIU 의뢰</div>
                            </div>
                            <div class="stat-card-icon purple">
                                <i class="fas fa-user-secret"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>사기 의심 청구 목록</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>청구번호</th>
                                        <th>고객명</th>
                                        <th>사기점수</th>
                                        <th>위험수준</th>
                                        <th>탐지 패턴</th>
                                        <th>권고조치</th>
                                        <th>액션</th>
                                    </tr>
                                </thead>
                                <tbody id="fraudClaimsTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Duplicate Insurance Page -->
            <div class="page" id="page-duplicate">
                <div class="card">
                    <div class="card-header">
                        <h3>중복보험 관리</h3>
                    </div>
                    <div class="card-body">
                        <div class="filter-bar">
                            <input type="text" class="form-control" placeholder="청구번호 검색" id="dupClaimSearch">
                            <button class="btn btn-primary" onclick="searchDuplicateInsurance()">
                                <i class="fas fa-search"></i> 검색
                            </button>
                            <button class="btn btn-info" onclick="showRealLossInquiry()">
                                <i class="fas fa-external-link-alt"></i> 실손보험 조회
                            </button>
                        </div>

                        <div id="duplicateInsuranceArea">
                            <p style="color: var(--gray); text-align: center; padding: 40px;">
                                청구번호를 검색하여 중복보험 정보를 확인하세요.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Audit Log Page -->
            <div class="page" id="page-audit">
                <div class="card">
                    <div class="card-header">
                        <h3>감사 로그</h3>
                        <button class="btn btn-outline" onclick="exportAuditLogs()">
                            <i class="fas fa-download"></i> 내보내기
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="filter-bar">
                            <select class="form-control" id="auditActionFilter">
                                <option value="">전체 액션</option>
                                <option value="LOGIN">로그인</option>
                                <option value="LOGOUT">로그아웃</option>
                                <option value="CLAIM_VIEW">청구 조회</option>
                                <option value="CLAIM_UPDATE">청구 수정</option>
                                <option value="APPROVAL">결재</option>
                            </select>
                            <input type="date" class="form-control" id="auditDateFrom">
                            <input type="date" class="form-control" id="auditDateTo">
                            <button class="btn btn-primary" onclick="filterAuditLogs()">
                                <i class="fas fa-search"></i> 검색
                            </button>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>일시</th>
                                        <th>사용자</th>
                                        <th>액션</th>
                                        <th>대상</th>
                                        <th>IP 주소</th>
                                        <th>결과</th>
                                        <th>상세</th>
                                    </tr>
                                </thead>
                                <tbody id="auditLogTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Page -->
            <div class="page" id="page-stats">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div>
                                <div class="stat-card-value">85%</div>
                                <div class="stat-card-label">자동 심사율</div>
                            </div>
                            <div class="stat-card-icon green">
                                <i class="fas fa-robot"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div>
                                <div class="stat-card-value">2.3일</div>
                                <div class="stat-card-label">평균 처리 기간</div>
                            </div>
                            <div class="stat-card-icon blue">
                                <i class="fas fa-calendar"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div>
                                <div class="stat-card-value">97.2%</div>
                                <div class="stat-card-label">고객 만족도</div>
                            </div>
                            <div class="stat-card-icon purple">
                                <i class="fas fa-smile"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>월별 처리 현황</h3>
                    </div>
                    <div class="card-body">
                        <p style="color: var(--gray); text-align: center; padding: 60px;">
                            <i class="fas fa-chart-line" style="font-size: 3rem; display: block; margin-bottom: 15px;"></i>
                            차트 영역 (Chart.js 연동 필요)
                        </p>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div class="page" id="page-settings">
                <div class="card">
                    <div class="card-header">
                        <h3>내 정보</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>이름</label>
                            <input type="text" class="form-control" id="settingName" readonly>
                        </div>
                        <div class="form-group">
                            <label>사원번호</label>
                            <input type="text" class="form-control" id="settingUserCode" readonly>
                        </div>
                        <div class="form-group">
                            <label>부서</label>
                            <input type="text" class="form-control" id="settingDept" readonly>
                        </div>
                        <div class="form-group">
                            <label>권한</label>
                            <input type="text" class="form-control" id="settingRole" readonly>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>비밀번호 변경</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>현재 비밀번호</label>
                            <input type="password" class="form-control" id="currentPassword">
                        </div>
                        <div class="form-group">
                            <label>새 비밀번호</label>
                            <input type="password" class="form-control" id="newPassword">
                            <small style="color: var(--gray);">대문자, 소문자, 숫자, 특수문자 포함 8자 이상</small>
                        </div>
                        <div class="form-group">
                            <label>새 비밀번호 확인</label>
                            <input type="password" class="form-control" id="confirmPassword">
                        </div>
                        <button class="btn btn-primary" onclick="changePassword()">
                            <i class="fas fa-key"></i> 비밀번호 변경
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>로그아웃</h3>
                    </div>
                    <div class="card-body">
                        <p style="margin-bottom: 15px; color: var(--gray);">현재 세션을 종료하고 로그아웃합니다.</p>
                        <button class="btn btn-danger" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> 로그아웃
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Approval Modal -->
    <div class="modal-overlay" id="approvalModal">
        <div class="modal">
            <div class="modal-header">
                <h3>결재 처리</h3>
                <button class="modal-close" onclick="closeModal('approvalModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="approvalModalContent">
                    <!-- Dynamic content -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('approvalModal')">취소</button>
                <button class="btn btn-danger" onclick="processApproval('REJECT')">반려</button>
                <button class="btn btn-warning" onclick="processApproval('RETURN')">보완요청</button>
                <button class="btn btn-success" onclick="processApproval('APPROVE')">승인</button>
            </div>
        </div>
    </div>

    <!-- Claim Detail Modal -->
    <div class="modal-overlay" id="claimDetailModal">
        <div class="modal" style="max-width: 1000px;">
            <div class="modal-header">
                <h3>청구 상세 정보</h3>
                <button class="modal-close" onclick="closeModal('claimDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="claimDetailContent">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000/api';
        let currentUser = null;
        let authToken = null;
        let currentApprovalId = null;
        let currentClaimId = null;

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            // Check authentication
            authToken = localStorage.getItem('authToken');
            const userData = localStorage.getItem('userData');

            if (!authToken || !userData) {
                window.location.href = 'login.html';
                return;
            }

            currentUser = JSON.parse(userData);
            updateUserDisplay();
            loadDashboardData();

            // Setup navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const page = item.dataset.page;
                    if (page) navigateTo(page);
                });
            });
        });

        // Update user display
        function updateUserDisplay() {
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userRole').textContent = currentUser.departmentName + ' / ' + getRoleName(currentUser.roleCode);
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0);

            // Settings page
            document.getElementById('settingName').value = currentUser.name;
            document.getElementById('settingUserCode').value = currentUser.userCode;
            document.getElementById('settingDept').value = currentUser.departmentName || '-';
            document.getElementById('settingRole').value = getRoleName(currentUser.roleCode);
        }

        function getRoleName(roleCode) {
            const roles = {
                'ADMIN': '시스템관리자',
                'EXECUTIVE': '임원',
                'MANAGER': '부장',
                'TEAM_LEAD': '팀장',
                'SENIOR': '선임',
                'STAFF': '담당자'
            };
            return roles[roleCode] || roleCode;
        }

        // Navigation
        function navigateTo(page) {
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });

            // Update pages
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            document.getElementById('page-' + page).classList.add('active');

            // Update title
            const titles = {
                'dashboard': '대시보드',
                'claims': '청구 심사',
                'approval-inbox': '결재함',
                'approval-history': '결재 이력',
                'documents': '서류 관리',
                'fraud': '사기 탐지',
                'duplicate': '중복보험',
                'audit': '감사 로그',
                'stats': '통계',
                'settings': '설정'
            };
            document.getElementById('pageTitle').textContent = titles[page] || page;

            // Load page data
            loadPageData(page);
        }

        // Load page data
        function loadPageData(page) {
            switch (page) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'claims':
                    loadClaims();
                    break;
                case 'approval-inbox':
                    loadApprovalInbox();
                    break;
                case 'approval-history':
                    loadApprovalHistory();
                    break;
                case 'fraud':
                    loadFraudData();
                    break;
                case 'audit':
                    loadAuditLogs();
                    break;
            }
        }

        // API Fetch helper
        async function apiFetch(endpoint, options = {}) {
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                }
            };

            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    ...defaultOptions,
                    ...options,
                    headers: { ...defaultOptions.headers, ...options.headers }
                });

                if (response.status === 401) {
                    // Token expired
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('userData');
                    window.location.href = 'login.html';
                    return null;
                }

                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                return null;
            }
        }

        // Load Dashboard Data
        async function loadDashboardData() {
            // Load stats
            const stats = await apiFetch('/stats/dashboard');
            if (stats && stats.success) {
                const overview = stats.data.overview || {};
                const byStatus = stats.data.by_status || [];

                document.getElementById('statTotalClaims').textContent = overview.total_claims || 0;
                document.getElementById('statPendingApproval').textContent = stats.data.pending_count || 0;

                // Calculate fraud alerts (claims with fraud_score > 50)
                const fraudCount = byStatus.reduce((sum, s) => sum + (s.status === 'HIGH_RISK' ? parseInt(s.count) : 0), 0);
                document.getElementById('statFraudAlert').textContent = fraudCount || 0;

                // Calculate completed today
                const completedCount = byStatus.reduce((sum, s) => sum + (s.status === 'APPROVED' ? parseInt(s.count) : 0), 0);
                document.getElementById('statCompletedToday').textContent = completedCount || 0;
            }

            // Load pending approval count
            const pending = await apiFetch('/approvals/pending-count');
            if (pending && pending.success) {
                document.getElementById('pendingApprovalCount').textContent = pending.data.pendingCount || 0;
                document.getElementById('statPendingApproval').textContent = pending.data.pendingCount || 0;
            }

            // Load recent claims
            const claims = await apiFetch('/claims?limit=10');
            if (claims && claims.success) {
                renderRecentClaims(claims.data);
                const pendingClaims = claims.data.filter(c => c.status === 'PENDING_REVIEW' || c.status === 'PENDING').length;
                document.getElementById('newClaimsCount').textContent = pendingClaims;
            }
        }

        function renderRecentClaims(claims) {
            const tbody = document.getElementById('recentClaimsTable');
            if (!claims || claims.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--gray);">데이터가 없습니다.</td></tr>';
                return;
            }

            tbody.innerHTML = claims.map(claim => `
                <tr onclick="showClaimDetail(${claim.id})" style="cursor: pointer;">
                    <td><strong>${claim.claim_number || 'CLM-' + String(claim.id).padStart(6, '0')}</strong></td>
                    <td>${claim.customer_name || '-'}</td>
                    <td>${claim.diagnosis_name || claim.diagnosis_code || '-'}</td>
                    <td>₩${Number(claim.total_claimed_amount || claim.claim_amount || 0).toLocaleString()}</td>
                    <td>${getStatusBadge(claim.status)}</td>
                    <td>${getApprovalStepBadge(claim.approval_step || claim.current_step)}</td>
                    <td>${formatDate(claim.created_at)}</td>
                </tr>
            `).join('');
        }

        function getStatusBadge(status) {
            const badges = {
                'RECEIVED': '<span class="badge badge-gray">접수</span>',
                'PENDING': '<span class="badge badge-gray">접수대기</span>',
                'PENDING_REVIEW': '<span class="badge badge-info">심사대기</span>',
                'PENDING_APPROVAL': '<span class="badge badge-warning">결재대기</span>',
                'IN_REVIEW': '<span class="badge badge-info">심사중</span>',
                'REVIEWING': '<span class="badge badge-info">심사중</span>',
                'APPROVED': '<span class="badge badge-success">승인</span>',
                'REJECTED': '<span class="badge badge-danger">거절</span>',
                'RETURNED': '<span class="badge badge-warning">보완요청</span>',
                'ON_HOLD': '<span class="badge badge-warning">보류</span>',
                'HOLD': '<span class="badge badge-warning">보류</span>',
                'SIU_REFERRED': '<span class="badge badge-danger">조사의뢰</span>'
            };
            return badges[status] || `<span class="badge badge-gray">${status}</span>`;
        }

        function getApprovalStepBadge(step) {
            if (!step) return '<span class="badge badge-gray">-</span>';
            const steps = {
                1: '담당자',
                2: '팀장',
                3: '부장',
                4: '임원'
            };
            return `<span class="badge badge-info">${steps[step] || step}단계</span>`;
        }

        // Load Claims
        async function loadClaims() {
            const claims = await apiFetch('/claims');
            if (claims && claims.success) {
                renderClaimsTable(claims.data);
            }
        }

        function renderClaimsTable(claims) {
            const tbody = document.getElementById('claimsTable');
            if (!claims || claims.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: var(--gray);">데이터가 없습니다.</td></tr>';
                return;
            }

            tbody.innerHTML = claims.map(claim => `
                <tr>
                    <td><strong>CLM-${String(claim.id).padStart(6, '0')}</strong></td>
                    <td>${claim.customer_name || '-'}</td>
                    <td>${claim.diagnosis_code || '-'}</td>
                    <td>₩${Number(claim.claim_amount || 0).toLocaleString()}</td>
                    <td>${getAIRecommendationBadge(claim.ai_recommendation)}</td>
                    <td>${getFraudScoreDisplay(claim.fraud_score)}</td>
                    <td>${getDocumentStatus(claim.doc_status)}</td>
                    <td>${getStatusBadge(claim.status)}</td>
                    <td>
                        <button class="btn btn-sm btn-outline" onclick="showClaimDetail(${claim.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-primary" onclick="startApproval(${claim.id})">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getAIRecommendationBadge(rec) {
            const badges = {
                'APPROVE': '<span class="badge badge-success">승인권고</span>',
                'AUTO_APPROVE': '<span class="badge badge-success">자동승인</span>',
                'REJECT': '<span class="badge badge-danger">거절권고</span>',
                'REVIEW': '<span class="badge badge-warning">검토필요</span>',
                'MANUAL_REVIEW': '<span class="badge badge-warning">수동심사</span>',
                'HOLD': '<span class="badge badge-info">보류</span>',
                'SIU_REFERRAL': '<span class="badge badge-danger">SIU의뢰</span>'
            };
            return badges[rec] || '<span class="badge badge-gray">' + (rec || '-') + '</span>';
        }

        function getFraudScoreDisplay(score) {
            if (!score) return '<span class="badge badge-gray">-</span>';
            const numScore = Number(score);
            if (numScore >= 70) return `<span class="badge badge-danger">${numScore}점</span>`;
            if (numScore >= 40) return `<span class="badge badge-warning">${numScore}점</span>`;
            return `<span class="badge badge-success">${numScore}점</span>`;
        }

        function getDocumentStatus(status) {
            const badges = {
                'COMPLETE': '<span class="badge badge-success">완료</span>',
                'INCOMPLETE': '<span class="badge badge-warning">미비</span>',
                'PENDING': '<span class="badge badge-gray">대기</span>'
            };
            return badges[status] || '<span class="badge badge-gray">-</span>';
        }

        // Load Approval Inbox
        async function loadApprovalInbox() {
            const inbox = await apiFetch('/approvals/inbox');
            if (inbox && inbox.success) {
                renderApprovalInbox(inbox.data);
                document.getElementById('inboxCount').textContent = inbox.data.length;
            }
        }

        function renderApprovalInbox(items) {
            const tbody = document.getElementById('approvalInboxTable');
            if (!items || items.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--gray);">결재 대기 건이 없습니다.</td></tr>';
                return;
            }

            tbody.innerHTML = items.map(item => `
                <tr>
                    <td><strong>CLM-${String(item.claim_id).padStart(6, '0')}</strong></td>
                    <td>${item.customer_name || '-'}</td>
                    <td>₩${Number(item.claim_amount || 0).toLocaleString()}</td>
                    <td>${item.requester_name || '-'}</td>
                    <td>${getUrgencyBadge(item.urgency)}</td>
                    <td>${formatDateTime(item.requested_at)}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="showApprovalModal(${item.approval_id}, ${item.claim_id})">
                            <i class="fas fa-check"></i> 결재
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getUrgencyBadge(urgency) {
            const badges = {
                'URGENT': '<span class="badge badge-danger">긴급</span>',
                'HIGH': '<span class="badge badge-warning">높음</span>',
                'NORMAL': '<span class="badge badge-info">보통</span>',
                'LOW': '<span class="badge badge-gray">낮음</span>'
            };
            return badges[urgency] || '<span class="badge badge-gray">-</span>';
        }

        // Load Approval History
        async function loadApprovalHistory() {
            const history = await apiFetch('/approvals/stats');
            // Simplified - would need actual history endpoint
            const tbody = document.getElementById('approvalHistoryTable');
            tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--gray);">결재 이력이 없습니다.</td></tr>';
        }

        // Load Fraud Data
        async function loadFraudData() {
            const highRisk = await apiFetch('/fraud/high-risk-claims?minScore=70&limit=20');
            if (highRisk && highRisk.success) {
                document.getElementById('fraudHighRisk').textContent = highRisk.data.filter(c => c.fraud_score >= 70).length;
                document.getElementById('fraudMediumRisk').textContent = highRisk.data.filter(c => c.fraud_score >= 40 && c.fraud_score < 70).length;
                document.getElementById('fraudSIU').textContent = highRisk.data.filter(c => c.siu_referred).length || 0;
                renderFraudTable(highRisk.data);
            }
        }

        function renderFraudTable(claims) {
            const tbody = document.getElementById('fraudClaimsTable');
            if (!claims || claims.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--gray);">사기 의심 건이 없습니다.</td></tr>';
                return;
            }

            tbody.innerHTML = claims.map(claim => `
                <tr>
                    <td><strong>CLM-${String(claim.id).padStart(6, '0')}</strong></td>
                    <td>${claim.customer_name || '-'}</td>
                    <td>
                        <div class="fraud-score-bar" style="width: 100px;">
                            <div class="fraud-score-fill ${getFraudScoreClass(claim.fraud_score)}"
                                 style="width: ${claim.fraud_score}%;"></div>
                        </div>
                        <span style="font-size: 0.8rem;">${claim.fraud_score}점</span>
                    </td>
                    <td>${getRiskLevelBadge(claim.fraud_score)}</td>
                    <td>${claim.fraud_patterns || '-'}</td>
                    <td>${getRecommendedAction(claim.fraud_score)}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="referToSIU(${claim.id})">
                            <i class="fas fa-user-secret"></i> SIU
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getFraudScoreClass(score) {
            if (score >= 70) return 'high';
            if (score >= 40) return 'medium';
            return 'low';
        }

        function getRiskLevelBadge(score) {
            if (score >= 70) return '<span class="badge badge-danger">고위험</span>';
            if (score >= 40) return '<span class="badge badge-warning">중위험</span>';
            return '<span class="badge badge-success">저위험</span>';
        }

        function getRecommendedAction(score) {
            if (score >= 70) return '<span class="badge badge-danger">SIU 의뢰</span>';
            if (score >= 40) return '<span class="badge badge-warning">정밀심사</span>';
            return '<span class="badge badge-success">자동승인</span>';
        }

        // Load Audit Logs
        async function loadAuditLogs() {
            const logs = await apiFetch('/audit/logs?limit=50');
            if (logs && logs.success) {
                renderAuditLogs(logs.data);
            }
        }

        function renderAuditLogs(logs) {
            const tbody = document.getElementById('auditLogTable');
            if (!logs || logs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--gray);">감사 로그가 없습니다.</td></tr>';
                return;
            }

            tbody.innerHTML = logs.map(log => `
                <tr>
                    <td>${formatDateTime(log.created_at)}</td>
                    <td>${log.user_name || log.user_code || '-'}</td>
                    <td><span class="badge badge-info">${log.action}</span></td>
                    <td>${log.entity_type} #${log.entity_id || '-'}</td>
                    <td>${log.ip_address || '-'}</td>
                    <td>${log.is_success ? '<span class="badge badge-success">성공</span>' : '<span class="badge badge-danger">실패</span>'}</td>
                    <td>
                        <button class="btn btn-sm btn-outline" onclick="showAuditDetail(${log.id})">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Show Approval Modal
        async function showApprovalModal(approvalId, claimId) {
            currentApprovalId = approvalId;
            currentClaimId = claimId;

            // Load claim detail
            const claim = await apiFetch(`/claims/${claimId}`);
            if (claim && claim.success) {
                const data = claim.data;
                document.getElementById('approvalModalContent').innerHTML = `
                    <div class="approval-flow">
                        <div class="approval-step">
                            <div class="approval-step-icon approved"><i class="fas fa-user"></i></div>
                            <div class="approval-step-label">담당자</div>
                            <div class="approval-step-name">${data.reviewer_name || '-'}</div>
                        </div>
                        <div class="approval-arrow"><i class="fas fa-arrow-right"></i></div>
                        <div class="approval-step">
                            <div class="approval-step-icon current"><i class="fas fa-user-tie"></i></div>
                            <div class="approval-step-label">팀장</div>
                            <div class="approval-step-name">${currentUser.name}</div>
                        </div>
                        <div class="approval-arrow"><i class="fas fa-arrow-right"></i></div>
                        <div class="approval-step">
                            <div class="approval-step-icon pending"><i class="fas fa-user-cog"></i></div>
                            <div class="approval-step-label">부장</div>
                            <div class="approval-step-name">-</div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="margin-bottom: 15px;">청구 정보</h4>
                            <table style="width: 100%;">
                                <tr><td style="color: var(--gray);">청구번호</td><td><strong>CLM-${String(data.id).padStart(6, '0')}</strong></td></tr>
                                <tr><td style="color: var(--gray);">고객명</td><td>${data.customer_name || '-'}</td></tr>
                                <tr><td style="color: var(--gray);">진단명</td><td>${data.diagnosis_name || data.diagnosis_code || '-'}</td></tr>
                                <tr><td style="color: var(--gray);">청구금액</td><td><strong>₩${Number(data.claim_amount || 0).toLocaleString()}</strong></td></tr>
                            </table>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 15px;">AI 분석 결과</h4>
                            <table style="width: 100%;">
                                <tr><td style="color: var(--gray);">AI 권고</td><td>${getAIRecommendationBadge(data.ai_recommendation)}</td></tr>
                                <tr><td style="color: var(--gray);">승인금액</td><td>₩${Number(data.approved_amount || 0).toLocaleString()}</td></tr>
                                <tr><td style="color: var(--gray);">사기점수</td><td>${getFraudScoreDisplay(data.fraud_score)}</td></tr>
                            </table>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label>결재 의견</label>
                        <textarea class="form-control" id="approvalComments" rows="3" placeholder="결재 의견을 입력하세요"></textarea>
                    </div>

                    <div class="form-group">
                        <label>조정 금액 (선택사항)</label>
                        <input type="number" class="form-control" id="adjustedAmount" placeholder="금액 조정 시 입력">
                    </div>
                `;
            }

            document.getElementById('approvalModal').classList.add('show');
        }

        // Process Approval
        async function processApproval(action) {
            const comments = document.getElementById('approvalComments').value;
            const adjustedAmount = document.getElementById('adjustedAmount').value;

            const result = await apiFetch(`/approvals/${currentApprovalId}/process`, {
                method: 'POST',
                body: JSON.stringify({
                    action,
                    comments,
                    adjustedAmount: adjustedAmount ? Number(adjustedAmount) : undefined
                })
            });

            if (result && result.success) {
                alert(result.message || '결재가 처리되었습니다.');
                closeModal('approvalModal');
                loadApprovalInbox();
                loadDashboardData();
            } else {
                alert(result?.error || '결재 처리에 실패했습니다.');
            }
        }

        // Start Approval
        async function startApproval(claimId) {
            if (!confirm('결재를 상신하시겠습니까?')) return;

            const result = await apiFetch('/approvals/start', {
                method: 'POST',
                body: JSON.stringify({
                    claimId,
                    urgency: 'NORMAL'
                })
            });

            if (result && result.success) {
                alert(result.message || '결재가 상신되었습니다.');
                loadClaims();
            } else {
                alert(result?.error || '결재 상신에 실패했습니다.');
            }
        }

        // Show Claim Detail - Enhanced with AI Model Comparison
        async function showClaimDetail(claimId) {
            // Load claim and AI results in parallel
            const [claimRes, aiRes] = await Promise.all([
                apiFetch(`/claims/${claimId}`),
                apiFetch(`/claims/${claimId}/ai-results`)
            ]);

            if (!claimRes || !claimRes.success) return;

            const data = claimRes.data;
            const aiResults = (aiRes && aiRes.success) ? aiRes.data : [];
            const selectedResult = aiResults.find(r => r.is_selected) || aiResults[0];

            document.getElementById('claimDetailContent').innerHTML = `
                <div class="tabs">
                    <div class="tab active" onclick="switchTab(this, 'info')">기본정보</div>
                    <div class="tab" onclick="switchTab(this, 'ai-compare')">AI 모델 비교 (${aiResults.length})</div>
                    <div class="tab" onclick="switchTab(this, 'coverage')">담보별 산출내역</div>
                    <div class="tab" onclick="switchTab(this, 'risk')">위험분석</div>
                    <div class="tab" onclick="switchTab(this, 'docs')">서류</div>
                    <div class="tab" onclick="switchTab(this, 'history')">이력</div>
                </div>

                <!-- 기본정보 탭 -->
                <div class="tab-content active" id="tab-info">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <h4 style="margin-bottom: 15px;"><i class="fas fa-file-invoice"></i> 청구 정보</h4>
                            <table style="width: 100%;">
                                <tr><td style="color: var(--gray); width: 120px;">청구번호</td><td><strong>${data.claim_number || 'CLM-' + String(data.id).padStart(6, '0')}</strong></td></tr>
                                <tr><td style="color: var(--gray);">상태</td><td>${getStatusBadge(data.status)}</td></tr>
                                <tr><td style="color: var(--gray);">청구유형</td><td>${data.claim_type || '-'}</td></tr>
                                <tr><td style="color: var(--gray);">청구금액</td><td><strong style="color: var(--primary);">₩${Number(data.total_claimed_amount || data.claim_amount || 0).toLocaleString()}</strong></td></tr>
                                <tr><td style="color: var(--gray);">승인금액</td><td><strong style="color: var(--success);">₩${Number(data.total_approved_amount || 0).toLocaleString()}</strong></td></tr>
                                <tr><td style="color: var(--gray);">접수일</td><td>${formatDate(data.created_at)}</td></tr>
                            </table>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 15px;"><i class="fas fa-hospital"></i> 의료 정보</h4>
                            <table style="width: 100%;">
                                <tr><td style="color: var(--gray); width: 120px;">진단코드</td><td>${data.diagnosis_code || '-'}</td></tr>
                                <tr><td style="color: var(--gray);">진단명</td><td>${data.diagnosis_name || '-'}</td></tr>
                                <tr><td style="color: var(--gray);">수술명</td><td>${data.surgery_name || '-'}</td></tr>
                                <tr><td style="color: var(--gray);">입원일수</td><td>${data.hospitalization_days || 0}일</td></tr>
                                <tr><td style="color: var(--gray);">병원명</td><td>${data.hospital_name || '-'}</td></tr>
                            </table>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h4 style="margin-bottom: 15px;"><i class="fas fa-user"></i> 고객/증권 정보</h4>
                        <table style="width: 100%;">
                            <tr>
                                <td style="color: var(--gray); width: 120px;">고객명</td><td>${data.customer_name || '-'}</td>
                                <td style="color: var(--gray); width: 120px;">증권번호</td><td>${data.policy_number || '-'}</td>
                            </tr>
                            <tr>
                                <td style="color: var(--gray);">위험등급</td><td>${data.risk_grade || '-'}</td>
                                <td style="color: var(--gray);">상품명</td><td>${data.product_name || '-'}</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- AI 모델 비교 탭 -->
                <div class="tab-content" id="tab-ai-compare">
                    <div class="alert alert-info" style="margin-bottom: 20px;">
                        <i class="fas fa-robot"></i>
                        <span><strong>${aiResults.length}개 AI 모델</strong>이 분석했습니다. 각 모델의 권고사항과 산출금액을 비교해 주세요.</span>
                    </div>
                    ${aiResults.length > 0 ? `
                        <div class="ai-model-grid">
                            ${aiResults.map(ai => `
                                <div class="ai-model-card ${ai.is_selected ? 'selected' : ''}" onclick="selectAIResult(${claimId}, ${ai.id})">
                                    <div class="ai-model-header">
                                        <div>
                                            <div class="ai-model-name">${ai.model_name}</div>
                                            <span class="ai-model-provider">${ai.provider}</span>
                                        </div>
                                        ${ai.is_selected ? '<span class="badge badge-success"><i class="fas fa-check"></i> 선택됨</span>' : ''}
                                    </div>
                                    <div class="ai-model-score ${ai.confidence_score >= 80 ? 'high' : ai.confidence_score >= 60 ? 'medium' : 'low'}">
                                        ${ai.confidence_score}점
                                    </div>
                                    <div style="margin-bottom: 10px;">
                                        ${getAIRecommendationBadge(ai.recommendation)}
                                        <span style="font-size: 0.8rem; color: var(--gray); margin-left: 10px;">
                                            응답시간: ${ai.response_time_ms || 0}ms
                                        </span>
                                    </div>
                                    <div class="ai-model-amounts">
                                        <div class="ai-amount-item">
                                            <label>승인금액</label>
                                            <div class="value approved">₩${Number(ai.total_approved_amount || 0).toLocaleString()}</div>
                                        </div>
                                        <div class="ai-amount-item">
                                            <label>불인정액</label>
                                            <div class="value rejected">₩${Number(ai.total_rejected_amount || 0).toLocaleString()}</div>
                                        </div>
                                    </div>
                                    <div style="font-size: 0.8rem; color: var(--gray);">
                                        정확도: ${ai.avg_accuracy ? ai.avg_accuracy.toFixed(1) : '-'}% | 평점: ${ai.avg_user_rating ? ai.avg_user_rating.toFixed(1) : '-'}/5
                                    </div>
                                    <div class="ai-model-reasoning">${ai.reasoning || '분석 내용 없음'}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<p style="color: var(--gray); text-align: center; padding: 40px;">AI 분석 결과가 없습니다.</p>'}
                </div>

                <!-- 담보별 산출내역 탭 -->
                <div class="tab-content" id="tab-coverage">
                    ${selectedResult && selectedResult.coverage_analysis ? `
                        <div class="alert alert-warning" style="margin-bottom: 20px;">
                            <i class="fas fa-edit"></i>
                            <span><strong>심사자 검토 필요:</strong> AI(${selectedResult.model_name})가 산출한 내역입니다. 금액을 직접 수정하고 <strong>재계산</strong> 버튼을 눌러 최종 금액을 확정하세요.</span>
                        </div>

                        <!-- 심사자 조정 섹션 -->
                        <div class="adjuster-section">
                            <div class="adjuster-section-header">
                                <i class="fas fa-user-edit"></i>
                                <span>심사자 금액 조정</span>
                                <button class="btn btn-recalculate btn-sm" onclick="recalculateTotal(${claimId})" style="margin-left: auto;">
                                    <i class="fas fa-calculator"></i> 재계산
                                </button>
                            </div>
                            ${renderEditableCoverageAnalysis(selectedResult.coverage_analysis, claimId)}
                        </div>

                        <!-- 변경 요약 -->
                        <div class="change-summary" id="changeSummary-${claimId}" style="display: none;">
                            <div class="change-summary-header">
                                <div class="change-summary-title">
                                    <i class="fas fa-exchange-alt"></i>
                                    <span>변경 내역</span>
                                </div>
                                <button class="btn btn-sm btn-outline" onclick="resetChanges(${claimId})">
                                    <i class="fas fa-undo"></i> 초기화
                                </button>
                            </div>
                            <div id="changeList-${claimId}"></div>
                        </div>

                        <!-- 최종 계산 -->
                        <div class="total-calculation" id="totalCalc-${claimId}">
                            <div class="total-row">
                                <span class="label">AI 산출 승인금액</span>
                                <span class="value" id="aiTotal-${claimId}">₩${Number(selectedResult.total_approved_amount || 0).toLocaleString()}</span>
                            </div>
                            <div class="total-row">
                                <span class="label">심사자 조정액</span>
                                <span class="value" id="adjustDiff-${claimId}" style="color: #f59e0b;">₩0</span>
                            </div>
                            <div class="total-row">
                                <span class="label">최종 승인금액</span>
                                <span class="value highlight" id="finalTotal-${claimId}">₩${Number(selectedResult.total_approved_amount || 0).toLocaleString()}</span>
                            </div>
                        </div>
                    ` : '<p style="color: var(--gray); text-align: center; padding: 40px;">담보 분석 데이터가 없습니다.</p>'}
                </div>

                <!-- 위험분석 탭 -->
                <div class="tab-content" id="tab-risk">
                    <div class="alert alert-info" style="margin-bottom: 20px;">
                        <i class="fas fa-sliders-h"></i>
                        <span><strong>위험 팩터 조정:</strong> 슬라이더를 움직여 각 팩터의 가중치를 조정할 수 있습니다. 조정 시 위험 점수가 재계산됩니다.</span>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <h4 style="margin-bottom: 15px;"><i class="fas fa-shield-alt"></i> 사기 위험도</h4>
                            <div class="fraud-score-bar" style="height: 25px; margin: 15px 0;">
                                <div class="fraud-score-fill ${getFraudScoreClass(data.fraud_score || 0)}"
                                     style="width: ${data.fraud_score || 0}%;" id="fraudScoreBar-${claimId}"></div>
                            </div>
                            <p style="font-size: 1.2rem;">
                                사기 점수: <strong id="fraudScoreValue-${claimId}">${data.fraud_score || 0}점</strong> - <span id="fraudScoreBadge-${claimId}">${getRiskLevelBadge(data.fraud_score || 0)}</span>
                            </p>
                            ${data.fraud_flags && data.fraud_flags.length > 0 ? `
                                <div style="margin-top: 20px;">
                                    <h5>탐지된 위험 요소</h5>
                                    <ul style="margin-top: 10px; padding-left: 20px;">
                                        ${data.fraud_flags.map(flag => `
                                            <li style="margin-bottom: 8px;">
                                                <strong>${flag.name}</strong> (${flag.score}점)
                                                <br><span style="font-size: 0.85rem; color: var(--gray);">${flag.details}</span>
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                        <div>
                            <h4 style="margin-bottom: 15px;"><i class="fas fa-clipboard-check"></i> AI 권고사항</h4>
                            <div class="alert ${data.ai_recommendation === 'AUTO_APPROVE' ? 'alert-success' : data.ai_recommendation === 'REJECT' ? 'alert-danger' : 'alert-warning'}">
                                ${getAIRecommendationBadge(data.ai_recommendation)}
                                <span style="margin-left: 10px;">신뢰도: ${data.ai_confidence_score || 0}%</span>
                            </div>
                            ${selectedResult && selectedResult.risk_factors ? `
                                <div style="margin-top: 20px;">
                                    <h5>위험 팩터 분석 <span style="font-size: 0.75rem; color: var(--gray);">(조정 가능)</span></h5>
                                    ${renderEditableRiskFactors(selectedResult.risk_factors, claimId)}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>

                <!-- 서류 탭 -->
                <div class="tab-content" id="tab-docs">
                    <h4 style="margin-bottom: 15px;"><i class="fas fa-file-alt"></i> 서류 체크리스트</h4>
                    <div id="docChecklistContent">
                        <p style="color: var(--gray);">서류 정보를 불러오는 중...</p>
                    </div>
                </div>

                <!-- 이력 탭 -->
                <div class="tab-content" id="tab-history">
                    <h4 style="margin-bottom: 15px;"><i class="fas fa-history"></i> 처리 이력</h4>
                    <div class="timeline">
                        <div class="timeline-item success">
                            <div class="timeline-time">${formatDateTime(data.created_at)}</div>
                            <div class="timeline-content">
                                <div class="timeline-title">청구 접수</div>
                                <div class="timeline-desc">청구가 접수되었습니다.</div>
                            </div>
                        </div>
                        ${aiResults.length > 0 ? `
                            <div class="timeline-item">
                                <div class="timeline-time">${formatDateTime(aiResults[0].created_at)}</div>
                                <div class="timeline-content">
                                    <div class="timeline-title">AI 분석 완료</div>
                                    <div class="timeline-desc">${aiResults.length}개 모델 분석 완료</div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;

            // Load document checklist
            loadDocumentChecklist(claimId);

            document.getElementById('claimDetailModal').classList.add('show');
        }

        // Render coverage analysis
        function renderCoverageAnalysis(coverage) {
            if (!coverage || !coverage.breakdown) return '<p>데이터 없음</p>';

            return coverage.breakdown.map(item => `
                <div class="coverage-item">
                    <div class="coverage-item-header">
                        <span class="coverage-item-title">${item.item}</span>
                        ${item.termReference ? `
                            <span class="coverage-term-ref" onclick="showTermDetail(this, '${item.termReference.article}', '${item.termReference.title}', '${item.termReference.content}', '${item.termReference.formula || ''}')">
                                <i class="fas fa-book"></i> ${item.termReference.article}
                            </span>
                        ` : ''}
                    </div>
                    <div class="coverage-calculation">${item.calculation}</div>
                    <div class="coverage-amounts">
                        <div class="coverage-amount">
                            <span class="label">승인:</span>
                            <span class="value approved">₩${Number(item.approvedAmount || 0).toLocaleString()}</span>
                        </div>
                        <div class="coverage-amount">
                            <span class="label">불인정:</span>
                            <span class="value rejected">₩${Number(item.rejectedAmount || 0).toLocaleString()}</span>
                        </div>
                    </div>
                    ${item.rejectionReason ? `<p style="font-size: 0.85rem; color: var(--gray); margin-top: 10px;"><i class="fas fa-info-circle"></i> ${item.rejectionReason}</p>` : ''}
                </div>
            `).join('');
        }

        // Show term detail popup
        function showTermDetail(el, article, title, content, formula) {
            // Remove existing detail
            const existing = el.closest('.coverage-item').querySelector('.term-detail');
            if (existing) {
                existing.remove();
                return;
            }

            const detail = document.createElement('div');
            detail.className = 'term-detail';
            detail.innerHTML = `
                <h5><i class="fas fa-gavel"></i> ${article} - ${title}</h5>
                <p>${content}</p>
                ${formula ? `<div class="formula"><strong>산출공식:</strong> ${formula}</div>` : ''}
            `;
            el.closest('.coverage-item').appendChild(detail);
        }

        // Render risk factors (read-only version)
        function renderRiskFactors(factors) {
            if (!factors || !Array.isArray(factors)) return '<p style="color: var(--gray);">위험 팩터 정보 없음</p>';

            return `<ul style="margin-top: 10px; padding-left: 20px;">
                ${factors.map(f => `
                    <li style="margin-bottom: 8px;">
                        <strong>${f.factor || f.name}</strong>: ${f.value || f.score || '-'}
                        ${f.description ? `<br><span style="font-size: 0.85rem; color: var(--gray);">${f.description}</span>` : ''}
                    </li>
                `).join('')}
            </ul>`;
        }

        // ========== 심사자 수정 기능 ==========

        // 원본 데이터 저장소
        const originalData = {};
        const modifiedData = {};

        // 수정 가능한 담보별 산출내역 렌더링
        function renderEditableCoverageAnalysis(coverage, claimId) {
            if (!coverage || !coverage.breakdown) return '<p>데이터 없음</p>';

            // 원본 데이터 저장
            originalData[claimId] = {
                coverage: JSON.parse(JSON.stringify(coverage)),
                totalApproved: coverage.breakdown.reduce((sum, item) => sum + (item.approvedAmount || 0), 0)
            };
            modifiedData[claimId] = JSON.parse(JSON.stringify(originalData[claimId]));

            return coverage.breakdown.map((item, index) => `
                <div class="coverage-item" id="coverage-${claimId}-${index}">
                    <div class="coverage-item-header">
                        <span class="coverage-item-title">${item.item}</span>
                        ${item.termReference ? `
                            <span class="coverage-term-ref" onclick="showTermDetail(this, '${item.termReference.article}', '${item.termReference.title}', '${item.termReference.content}', '${item.termReference.formula || ''}')">
                                <i class="fas fa-book"></i> ${item.termReference.article} (약관 근거)
                            </span>
                        ` : ''}
                    </div>

                    <!-- AI 산출 근거 표시 -->
                    <div class="evidence-panel show" style="display: block;">
                        <h5><i class="fas fa-robot"></i> AI 산출 근거</h5>
                        <div class="evidence-item">
                            <strong>산출 공식:</strong> ${item.calculation || '-'}
                            <div class="source">출처: ${item.termReference ? item.termReference.article : 'AI 분석'}</div>
                        </div>
                        ${item.rejectionReason ? `
                            <div class="evidence-item" style="border-left: 3px solid var(--danger); padding-left: 10px;">
                                <strong>불인정 사유:</strong> ${item.rejectionReason}
                            </div>
                        ` : ''}
                    </div>

                    <!-- 수정 가능한 금액 필드 -->
                    <div class="editable-field" id="field-approved-${claimId}-${index}">
                        <label>승인금액</label>
                        <span class="original-value" id="orig-approved-${claimId}-${index}" style="display: none;">
                            ₩${Number(item.approvedAmount || 0).toLocaleString()}
                        </span>
                        <input type="number"
                               id="input-approved-${claimId}-${index}"
                               value="${item.approvedAmount || 0}"
                               data-original="${item.approvedAmount || 0}"
                               data-claim="${claimId}"
                               data-index="${index}"
                               data-type="approved"
                               onchange="onAmountChange(this)"
                               style="max-width: 200px;">
                        <span class="ai-source" onclick="toggleEvidence(${claimId}, ${index})">
                            <i class="fas fa-info-circle"></i> AI 산출 상세
                        </span>
                    </div>

                    <div class="editable-field" id="field-rejected-${claimId}-${index}">
                        <label>불인정금액</label>
                        <span class="original-value" id="orig-rejected-${claimId}-${index}" style="display: none;">
                            ₩${Number(item.rejectedAmount || 0).toLocaleString()}
                        </span>
                        <input type="number"
                               id="input-rejected-${claimId}-${index}"
                               value="${item.rejectedAmount || 0}"
                               data-original="${item.rejectedAmount || 0}"
                               data-claim="${claimId}"
                               data-index="${index}"
                               data-type="rejected"
                               onchange="onAmountChange(this)"
                               style="max-width: 200px;">
                    </div>

                    <!-- 심사자 의견 입력 -->
                    <div class="form-group" style="margin-top: 10px;">
                        <label style="font-size: 0.85rem; color: var(--gray);">
                            <i class="fas fa-comment"></i> 조정 사유 (선택)
                        </label>
                        <input type="text"
                               class="form-control"
                               id="reason-${claimId}-${index}"
                               placeholder="금액 조정 시 사유를 입력하세요"
                               style="font-size: 0.9rem;">
                    </div>
                </div>
            `).join('');
        }

        // 수정 가능한 위험 팩터 렌더링
        function renderEditableRiskFactors(factors, claimId) {
            if (!factors || !Array.isArray(factors)) return '<p style="color: var(--gray);">위험 팩터 정보 없음</p>';

            // 팩터 원본 저장
            if (!originalData[claimId]) originalData[claimId] = {};
            originalData[claimId].factors = JSON.parse(JSON.stringify(factors));

            return `<div style="margin-top: 15px;">
                ${factors.map((f, index) => `
                    <div class="editable-field" style="flex-direction: column; align-items: stretch;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <label style="flex: none;">${f.factor || f.name}</label>
                            <span style="font-size: 0.75rem; color: var(--gray);">
                                AI 산출: ${f.value || f.score || 0}
                            </span>
                        </div>
                        <div class="factor-slider-container">
                            <input type="range"
                                   class="factor-slider"
                                   id="factor-${claimId}-${index}"
                                   min="0" max="100"
                                   value="${f.value || f.score || 50}"
                                   data-original="${f.value || f.score || 50}"
                                   data-claim="${claimId}"
                                   data-index="${index}"
                                   oninput="onFactorChange(this)">
                            <span class="factor-value-display" id="factor-display-${claimId}-${index}">
                                ${f.value || f.score || 50}
                            </span>
                        </div>
                        ${f.description ? `
                            <div style="font-size: 0.8rem; color: var(--gray); margin-top: 5px;">
                                <i class="fas fa-info-circle"></i> ${f.description}
                            </div>
                        ` : ''}
                    </div>
                `).join('')}

                <div style="margin-top: 15px; padding: 15px; background: var(--light); border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 600;">조정된 위험 점수:</span>
                        <span id="adjustedRiskScore-${claimId}" style="font-size: 1.5rem; font-weight: 700; color: var(--warning);">
                            계산 중...
                        </span>
                    </div>
                </div>
            </div>`;
        }

        // 금액 변경 이벤트 처리
        function onAmountChange(input) {
            const claimId = input.dataset.claim;
            const index = input.dataset.index;
            const type = input.dataset.type;
            const original = parseFloat(input.dataset.original);
            const current = parseFloat(input.value) || 0;

            const field = document.getElementById(`field-${type}-${claimId}-${index}`);
            const origSpan = document.getElementById(`orig-${type}-${claimId}-${index}`);

            if (current !== original) {
                field.classList.add('modified');
                origSpan.style.display = 'block';
            } else {
                field.classList.remove('modified');
                origSpan.style.display = 'none';
            }

            updateChangeSummary(claimId);
        }

        // 팩터 변경 이벤트 처리
        function onFactorChange(slider) {
            const claimId = slider.dataset.claim;
            const index = slider.dataset.index;
            const value = slider.value;

            document.getElementById(`factor-display-${claimId}-${index}`).textContent = value;

            // 위험 점수 재계산
            recalculateRiskScore(claimId);
        }

        // 위험 점수 재계산
        function recalculateRiskScore(claimId) {
            const factors = originalData[claimId]?.factors || [];
            let totalScore = 0;
            let count = 0;

            factors.forEach((f, index) => {
                const slider = document.getElementById(`factor-${claimId}-${index}`);
                if (slider) {
                    totalScore += parseFloat(slider.value);
                    count++;
                }
            });

            const avgScore = count > 0 ? Math.round(totalScore / count) : 0;
            const scoreEl = document.getElementById(`adjustedRiskScore-${claimId}`);
            if (scoreEl) {
                scoreEl.textContent = `${avgScore}점`;
                scoreEl.style.color = avgScore >= 70 ? 'var(--danger)' : avgScore >= 40 ? 'var(--warning)' : 'var(--success)';
            }

            // 사기 점수 바 업데이트
            const bar = document.getElementById(`fraudScoreBar-${claimId}`);
            const scoreValue = document.getElementById(`fraudScoreValue-${claimId}`);
            if (bar) {
                bar.style.width = avgScore + '%';
            }
            if (scoreValue) {
                scoreValue.textContent = avgScore + '점';
            }
        }

        // 변경 요약 업데이트
        function updateChangeSummary(claimId) {
            const original = originalData[claimId];
            if (!original || !original.coverage) return;

            const changes = [];
            let newTotal = 0;

            original.coverage.breakdown.forEach((item, index) => {
                const approvedInput = document.getElementById(`input-approved-${claimId}-${index}`);
                const rejectedInput = document.getElementById(`input-rejected-${claimId}-${index}`);
                const reasonInput = document.getElementById(`reason-${claimId}-${index}`);

                const newApproved = parseFloat(approvedInput?.value) || 0;
                const newRejected = parseFloat(rejectedInput?.value) || 0;
                const reason = reasonInput?.value || '';

                newTotal += newApproved;

                if (newApproved !== (item.approvedAmount || 0)) {
                    changes.push({
                        item: item.item,
                        type: '승인금액',
                        original: item.approvedAmount || 0,
                        modified: newApproved,
                        reason: reason
                    });
                }

                if (newRejected !== (item.rejectedAmount || 0)) {
                    changes.push({
                        item: item.item,
                        type: '불인정금액',
                        original: item.rejectedAmount || 0,
                        modified: newRejected,
                        reason: reason
                    });
                }
            });

            const summaryEl = document.getElementById(`changeSummary-${claimId}`);
            const listEl = document.getElementById(`changeList-${claimId}`);

            if (changes.length > 0) {
                summaryEl.style.display = 'block';
                listEl.innerHTML = changes.map(c => {
                    const diff = c.modified - c.original;
                    const diffClass = diff > 0 ? 'positive' : 'negative';
                    return `
                        <div class="change-row">
                            <span class="item-name">${c.item} (${c.type})</span>
                            <div class="values">
                                <span class="original">₩${c.original.toLocaleString()}</span>
                                <span class="arrow">→</span>
                                <span class="modified">₩${c.modified.toLocaleString()}</span>
                                <span class="diff ${diffClass}">${diff > 0 ? '+' : ''}₩${diff.toLocaleString()}</span>
                            </div>
                        </div>
                        ${c.reason ? `<div style="font-size: 0.8rem; color: var(--gray); padding: 5px 15px;">사유: ${c.reason}</div>` : ''}
                    `;
                }).join('');
            } else {
                summaryEl.style.display = 'none';
            }

            // 총액 업데이트
            const aiTotal = original.totalApproved;
            const diff = newTotal - aiTotal;

            document.getElementById(`adjustDiff-${claimId}`).textContent =
                `${diff >= 0 ? '+' : ''}₩${diff.toLocaleString()}`;
            document.getElementById(`adjustDiff-${claimId}`).style.color =
                diff > 0 ? 'var(--success)' : diff < 0 ? 'var(--danger)' : '#f59e0b';
            document.getElementById(`finalTotal-${claimId}`).textContent =
                `₩${newTotal.toLocaleString()}`;
        }

        // 재계산 버튼 클릭
        function recalculateTotal(claimId) {
            updateChangeSummary(claimId);

            // 변경 사항 확인 알림
            const summaryEl = document.getElementById(`changeSummary-${claimId}`);
            if (summaryEl.style.display === 'block') {
                alert('금액이 재계산되었습니다. 변경 내역을 확인해주세요.');
            } else {
                alert('변경된 금액이 없습니다.');
            }
        }

        // 변경 초기화
        function resetChanges(claimId) {
            const original = originalData[claimId];
            if (!original || !original.coverage) return;

            original.coverage.breakdown.forEach((item, index) => {
                const approvedInput = document.getElementById(`input-approved-${claimId}-${index}`);
                const rejectedInput = document.getElementById(`input-rejected-${claimId}-${index}`);
                const reasonInput = document.getElementById(`reason-${claimId}-${index}`);

                if (approvedInput) {
                    approvedInput.value = item.approvedAmount || 0;
                    onAmountChange(approvedInput);
                }
                if (rejectedInput) {
                    rejectedInput.value = item.rejectedAmount || 0;
                    onAmountChange(rejectedInput);
                }
                if (reasonInput) {
                    reasonInput.value = '';
                }
            });

            updateChangeSummary(claimId);
            alert('모든 변경 사항이 초기화되었습니다.');
        }

        // 근거 자료 토글
        function toggleEvidence(claimId, index) {
            const panel = document.querySelector(`#coverage-${claimId}-${index} .evidence-panel`);
            if (panel) {
                panel.classList.toggle('show');
                panel.style.display = panel.classList.contains('show') ? 'block' : 'none';
            }
        }

        // Select AI result
        async function selectAIResult(claimId, resultId) {
            const result = await apiFetch(`/claims/${claimId}/ai-results/${resultId}/select`, {
                method: 'POST',
                body: JSON.stringify({ selected_by: currentUser.name })
            });

            if (result && result.success) {
                showClaimDetail(claimId); // Refresh
            }
        }

        // Load document checklist for claim detail
        async function loadDocumentChecklist(claimId) {
            const checklist = await apiFetch(`/documents/checklist/${claimId}`);
            const container = document.getElementById('docChecklistContent');

            if (checklist && checklist.success && checklist.data.length > 0) {
                container.innerHTML = `
                    <ul class="document-checklist">
                        ${checklist.data.map(item => `
                            <li class="document-item ${item.is_required ? 'required' : ''} ${item.status === 'VERIFIED' ? 'verified' : item.status === 'SUBMITTED' ? 'submitted' : ''}">
                                <div class="document-checkbox">
                                    ${item.status === 'VERIFIED' || item.status === 'SUBMITTED' ? '<i class="fas fa-check"></i>' : ''}
                                </div>
                                <div class="document-info">
                                    <div class="document-name">${item.document_name} ${item.is_required ? '<span style="color: var(--danger);">*필수</span>' : ''}</div>
                                    <div class="document-status">${getDocStatusText(item.status)}</div>
                                </div>
                            </li>
                        `).join('')}
                    </ul>
                `;
            } else {
                container.innerHTML = '<p style="color: var(--gray);">등록된 서류 체크리스트가 없습니다.</p>';
            }
        }

        function switchTab(el, tabId) {
            el.parentElement.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');

            el.closest('.modal-body').querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        // Document Search
        async function searchDocuments() {
            const claimId = document.getElementById('docClaimSearch').value;
            if (!claimId) {
                alert('청구번호를 입력해주세요.');
                return;
            }

            const checklist = await apiFetch(`/documents/checklist/${claimId}`);
            if (checklist && checklist.success) {
                renderDocumentChecklist(checklist.data);
            } else {
                document.getElementById('documentChecklistArea').innerHTML = `
                    <p style="color: var(--danger); text-align: center; padding: 40px;">
                        서류 정보를 찾을 수 없습니다.
                    </p>
                `;
            }
        }

        function renderDocumentChecklist(items) {
            if (!items || items.length === 0) {
                document.getElementById('documentChecklistArea').innerHTML = `
                    <p style="color: var(--gray); text-align: center; padding: 40px;">
                        등록된 서류 체크리스트가 없습니다.
                    </p>
                `;
                return;
            }

            document.getElementById('documentChecklistArea').innerHTML = `
                <ul class="document-checklist">
                    ${items.map(item => `
                        <li class="document-item ${item.is_required ? 'required' : ''} ${item.status === 'VERIFIED' ? 'verified' : item.status === 'SUBMITTED' ? 'submitted' : ''}">
                            <div class="document-checkbox">
                                ${item.status === 'VERIFIED' || item.status === 'SUBMITTED' ? '<i class="fas fa-check"></i>' : ''}
                            </div>
                            <div class="document-info">
                                <div class="document-name">${item.document_name} ${item.is_required ? '<span style="color: var(--danger);">*필수</span>' : ''}</div>
                                <div class="document-status">${getDocStatusText(item.status)}</div>
                            </div>
                            <div class="document-actions">
                                ${item.status === 'PENDING' ? `<button class="btn btn-sm btn-primary">업로드</button>` : ''}
                                ${item.status === 'SUBMITTED' ? `<button class="btn btn-sm btn-success">검증</button>` : ''}
                            </div>
                        </li>
                    `).join('')}
                </ul>
            `;
        }

        function getDocStatusText(status) {
            const texts = {
                'PENDING': '미제출',
                'SUBMITTED': '제출완료 (검증대기)',
                'VERIFIED': '검증완료',
                'REJECTED': '반려됨'
            };
            return texts[status] || status;
        }

        // Duplicate Insurance Search
        async function searchDuplicateInsurance() {
            const claimId = document.getElementById('dupClaimSearch').value;
            if (!claimId) {
                alert('청구번호를 입력해주세요.');
                return;
            }

            const summary = await apiFetch(`/duplicate-insurance/summary/${claimId}`);
            if (summary && summary.success) {
                renderDuplicateSummary(summary.data);
            }
        }

        function renderDuplicateSummary(data) {
            document.getElementById('duplicateInsuranceArea').innerHTML = `
                <div class="alert ${data.hasDuplicate ? 'alert-warning' : 'alert-success'}">
                    <i class="fas ${data.hasDuplicate ? 'fa-exclamation-triangle' : 'fa-check-circle'}"></i>
                    <span>${data.hasDuplicate ? '중복보험이 존재합니다.' : '중복보험이 없습니다.'}</span>
                </div>

                ${data.hasDuplicate ? `
                    <div class="card" style="margin-top: 20px;">
                        <div class="card-header">
                            <h3>타사 보험 정보</h3>
                        </div>
                        <div class="card-body">
                            <table>
                                <thead>
                                    <tr>
                                        <th>보험사</th>
                                        <th>상품유형</th>
                                        <th>담보한도</th>
                                        <th>분담비율</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${(data.otherInsurances || []).map(ins => `
                                        <tr>
                                            <td>${ins.insurance_company}</td>
                                            <td>${ins.product_type}</td>
                                            <td>₩${Number(ins.coverage_amount || 0).toLocaleString()}</td>
                                            <td>${ins.share_ratio || '-'}%</td>
                                        </tr>
                                    `).join('') || '<tr><td colspan="4">정보 없음</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 20px;">
                        <div class="card-header">
                            <h3>비례분담 계산</h3>
                        </div>
                        <div class="card-body">
                            <p>총 청구금액: ₩${Number(data.totalAmount || 0).toLocaleString()}</p>
                            <p>당사 분담액: <strong style="color: var(--primary);">₩${Number(data.ourShare || 0).toLocaleString()}</strong></p>
                        </div>
                    </div>
                ` : ''}
            `;
        }

        // SIU Referral
        async function referToSIU(claimId) {
            const reason = prompt('SIU 조사 의뢰 사유를 입력하세요:');
            if (!reason) return;

            const result = await apiFetch(`/fraud/siu-referral/${claimId}`, {
                method: 'POST',
                body: JSON.stringify({ reason, priority: 'HIGH' })
            });

            if (result && result.success) {
                alert('SIU 조사가 의뢰되었습니다.');
                loadFraudData();
            } else {
                alert(result?.error || 'SIU 의뢰에 실패했습니다.');
            }
        }

        // Filter functions
        function filterClaims() {
            loadClaims();
        }

        function filterAuditLogs() {
            loadAuditLogs();
        }

        // Export Audit Logs
        function exportAuditLogs() {
            alert('감사 로그 내보내기 기능은 관리자 권한이 필요합니다.');
        }

        // Real Loss Inquiry
        function showRealLossInquiry() {
            alert('실손보험 조회 서비스와 연동이 필요합니다.');
        }

        // Change Password
        async function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPw = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;

            if (!current || !newPw || !confirm) {
                alert('모든 필드를 입력해주세요.');
                return;
            }

            if (newPw !== confirm) {
                alert('새 비밀번호가 일치하지 않습니다.');
                return;
            }

            const result = await apiFetch('/auth/password', {
                method: 'PUT',
                body: JSON.stringify({
                    currentPassword: current,
                    newPassword: newPw
                })
            });

            if (result && result.success) {
                alert('비밀번호가 변경되었습니다.');
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
            } else {
                alert(result?.error || '비밀번호 변경에 실패했습니다.');
            }
        }

        // Logout
        async function logout() {
            if (!confirm('로그아웃 하시겠습니까?')) return;

            await apiFetch('/auth/logout', { method: 'POST' });

            localStorage.removeItem('authToken');
            localStorage.removeItem('userData');
            window.location.href = 'login.html';
        }

        // Utilities
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('ko-KR');
        }

        function formatDateTime(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleString('ko-KR');
        }

        function showNotifications() {
            alert('알림 기능은 준비 중입니다.');
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('userDropdown');
            const userMenu = document.querySelector('.user-menu-container');
            if (dropdown && !userMenu.contains(e.target)) {
                dropdown.classList.remove('show');
            }
        });

        function showAuditDetail(logId) {
            alert('감사 로그 상세 조회 (ID: ' + logId + ')');
        }
    </script>
</body>
</html>
